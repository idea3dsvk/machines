import{a as j}from"./chunk-SOQTHN6Q.js";import{a as R}from"./chunk-QKRSOZBK.js";import{a as O}from"./chunk-4CAQGVAX.js";import{A as o,Da as V,Ea as M,F as q,Fa as H,N as x,O as g,R as F,S as k,T as L,U as a,V as t,W as C,_ as P,aa as _,ca as u,ga as Q,ha as r,ia as c,ja as h,ka as N,p as I,q as y,r as f,ta as z,ua as p,v as S,va as m,wa as B,ya as T}from"./chunk-NTPXKIXG.js";import{a as D,b as A}from"./chunk-K5CSBBV3.js";var W=(l,n,e)=>({"bg-green-100 text-green-800":l,"bg-red-100 text-red-800":n,"bg-blue-100 text-blue-800":e}),U=(l,n)=>n.id;function K(l,n){if(l&1){let e=P();a(0,"button",15),_("click",function(){y(e);let i=u();return f(i.toggleAddForm())}),r(1),p(2,"translate"),t()}if(l&2){let e=u();o(),h(" ",e.showAddForm()?"CANCEL":m(2,1,"ADD_NEW_PART")," ")}}function Z(l,n){if(l&1&&(a(0,"option",28),r(1),t()),l&2){let e=n.$implicit;L("value",e.id),o(),N("",e.name," (",e.type,")")}}function Y(l,n){if(l&1){let e=P();a(0,"div",3)(1,"h2",16),r(2),p(3,"translate"),t(),a(4,"form",17),_("submit",function(i){y(e);let s=u();return f(s.addPart(i))}),a(5,"div",18)(6,"div")(7,"label",19),r(8),p(9,"translate"),t(),C(10,"input",20),t(),a(11,"div")(12,"label",19),r(13),p(14,"translate"),t(),C(15,"input",21),t(),a(16,"div")(17,"label",19),r(18),p(19,"translate"),t(),C(20,"input",22),t(),a(21,"div")(22,"label",19),r(23),p(24,"translate"),t(),C(25,"input",23),t(),a(26,"div")(27,"label",19),r(28),p(29,"translate"),t(),C(30,"input",24),t(),a(31,"div",25)(32,"label",19),r(33,"Zariadenie (nepovinn\xE9)"),t(),a(34,"select",26)(35,"option",27),r(36,"-- V\u0161eobecn\xFD diel (nie je priraden\xFD k zariadeniu) --"),t(),F(37,Z,2,3,"option",28,U),t(),a(39,"p",29),r(40,"Vyberte zariadenie ak diel patr\xED k \u0161pecifick\xE9mu zariadeniu"),t()()(),a(41,"div",30)(42,"button",31),_("click",function(){y(e);let i=u();return f(i.toggleAddForm())}),r(43," Cancel "),t(),a(44,"button",32),r(45," Add Part "),t()()()()}if(l&2){let e=u();o(2),c(m(3,6,"ADD_NEW_PART")),o(6),c(m(9,8,"PART_NAME")),o(5),c(m(14,10,"SKU")),o(5),c(m(19,12,"QUANTITY")),o(5),c(m(24,14,"MIN_QUANTITY")),o(5),c(m(29,16,"LOCATION")),o(9),k(e.devices())}}function G(l,n){if(l&1&&(a(0,"div",52),r(1),t()),l&2){let e=u(2).$implicit;o(),c(e.deviceType)}}function J(l,n){if(l&1&&(a(0,"div",41)(1,"div",43),r(2),t(),x(3,G,2,1,"div",52),t()),l&2){let e=u().$implicit;o(2),c(e.deviceName),o(),g(e.deviceType?3:-1)}}function X(l,n){l&1&&(a(0,"span",42),r(1,"V\u0161eobecn\xFD"),t())}function ee(l,n){l&1&&(a(0,"div",44),r(1,"\u26A0\uFE0F Pod minimom"),t())}function te(l,n){if(l&1&&(a(0,"div",55),r(1),t()),l&2){let e=u(2).$implicit;o(),h(' "',e.lastChange.notes,'" ')}}function ie(l,n){if(l&1&&(a(0,"div",47)(1,"div",53),r(2),p(3,"date"),t(),a(4,"div",54),r(5),t(),x(6,te,2,1,"div",55),a(7,"div",56),r(8),t()()),l&2){let e=u().$implicit;o(2),h(" ",B(3,6,e.lastChange.date,"dd.MM.yyyy HH:mm")," "),o(3),h(" ",e.lastChange.changedBy," "),o(),g(e.lastChange.notes?6:-1),o(),L("ngClass",z(9,W,e.lastChange.changeType==="increase",e.lastChange.changeType==="decrease",e.lastChange.changeType==="set")),o(),N(" ",e.lastChange.quantityBefore," \u2192 ",e.lastChange.quantityAfter," ")}}function ne(l,n){l&1&&(a(0,"span",48),r(1,"Bez zmien"),t())}function ae(l,n){if(l&1){let e=P();a(0,"button",57),_("click",function(){y(e);let i=u().$implicit,s=u(2);return f(s.setQuantity(i.id,i.quantity))}),r(1," \u270E "),t(),a(2,"button",58),_("click",function(){y(e);let i=u().$implicit,s=u(2);return f(s.deletePart(i.id,i.name))}),r(3," \u{1F5D1}\uFE0F "),t()}}function re(l,n){if(l&1){let e=P();a(0,"tr",38)(1,"td",39),r(2),t(),a(3,"td",40),r(4),t(),a(5,"td",40),x(6,J,4,2,"div",41)(7,X,2,0,"span",42),t(),a(8,"td",40),r(9),t(),a(10,"td",35)(11,"div",43),r(12),t(),x(13,ee,2,0,"div",44),t(),a(14,"td",45),r(15),t(),a(16,"td",46),x(17,ie,9,13,"div",47)(18,ne,2,0,"span",48),t(),a(19,"td",34)(20,"div",49)(21,"button",50),_("click",function(){let i=y(e).$implicit,s=u(2);return f(s.decreaseQuantity(i.id,i.quantity))}),r(22," \u2212 "),t(),x(23,ae,4,0),a(24,"button",51),_("click",function(){let i=y(e).$implicit,s=u(2);return f(s.increaseQuantity(i.id,i.quantity))}),r(25," + "),t()()()()}if(l&2){let e=n.$implicit,d=u(2);o(2),c(e.name),o(2),c(e.sku),o(2),g(e.deviceName?6:7),o(3),c(e.location),o(),Q(d.getQuantityClass(e.quantity,e.minQuantity)),o(2),c(e.quantity),o(),g(e.quantity<e.minQuantity?13:-1),o(2),h(" ",e.minQuantity," "),o(2),g(e.lastChange?17:18),o(6),g(d.authService.isAdmin()?23:-1)}}function oe(l,n){if(l&1&&(a(0,"table",13)(1,"thead")(2,"tr",33)(3,"th",34),r(4),p(5,"translate"),t(),a(6,"th",34),r(7),p(8,"translate"),t(),a(9,"th",34),r(10,"Zariadenie"),t(),a(11,"th",34),r(12),p(13,"translate"),t(),a(14,"th",35),r(15),p(16,"translate"),t(),a(17,"th",35),r(18),p(19,"translate"),t(),a(20,"th",34),r(21,"Posledn\xE1 zmena"),t(),a(22,"th",36),r(23,"Actions"),t()()(),a(24,"tbody",37),F(25,re,26,11,"tr",38,U),t()()),l&2){let e=u();o(4),c(m(5,5,"PART_NAME")),o(3),c(m(8,7,"SKU")),o(5),c(m(13,9,"LOCATION")),o(3),c(m(16,11,"QUANTITY")),o(3),c(m(19,13,"MIN_QUANTITY")),o(7),k(e.filteredParts())}}function le(l,n){l&1&&(a(0,"div",14)(1,"p",54),r(2),p(3,"translate"),t()()),l&2&&(o(2),c(m(3,1,"LOADING_PARTS")))}function de(l,n){l&1&&(a(0,"div",14)(1,"p",54),r(2),p(3,"translate"),t()()),l&2&&(o(2),c(m(3,1,"NO_PARTS_FOUND")))}var E=class E{constructor(){this.dataService=I(R);this.authService=I(j);this.parts=T(()=>this.dataService.getPartsSignal()());this.devices=T(()=>this.dataService.getDevicesSignal()());this.searchTerm=S("");this.showAddForm=S(!1);this.partsWithHistory=S([]);this.stockFilter=S("all");this.filteredParts=T(()=>{let n=this.searchTerm().toLowerCase(),e=this.stockFilter(),i=this.partsWithHistory().length>0?this.partsWithHistory():this.parts();return e==="below-min"?i=i.filter(s=>s.quantity<s.minQuantity):e==="low"?i=i.filter(s=>s.quantity>=s.minQuantity&&s.quantity<s.minQuantity*1.5):e==="ok"&&(i=i.filter(s=>s.quantity>=s.minQuantity*1.5)),n&&(i=i.filter(s=>s.name.toLowerCase().includes(n)||s.sku.toLowerCase().includes(n)||s.location.toLowerCase().includes(n)||s.deviceName&&s.deviceName.toLowerCase().includes(n))),i});this.dataService.getParts().subscribe(()=>{this.loadPartsHistory()}),this.dataService.loadDevices().subscribe()}loadPartsHistory(){let n=this.parts(),e=[];n.forEach(d=>{this.dataService.getPartLastChange(d.id).subscribe(i=>{e.push(A(D({},d),{lastChange:i?{date:i.created_at,changedBy:i.changed_by,notes:i.notes,changeType:i.change_type,quantityBefore:i.quantity_before,quantityAfter:i.quantity_after}:void 0})),e.length===n.length&&this.partsWithHistory.set(e)})})}onSearch(n){let e=n.target;this.searchTerm.set(e.value)}onFilterChange(n){let e=n.target;this.stockFilter.set(e.value)}getQuantityClass(n,e=10){return n<e?"text-red-600 font-bold":n<e*1.5?"text-yellow-600":"text-gray-800"}toggleAddForm(){this.showAddForm.update(n=>!n)}increaseQuantity(n,e){let d=prompt("D\xF4vod zv\xFD\u0161enia mno\u017Estva (POVINN\xC9 - napr. n\xE1kup, dod\xE1vka):");if(!d||d.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zv\xFD\u0161en\xED mno\u017Estva");return}console.log("\u2795 Increasing quantity for part:",n),this.dataService.updatePartQuantity(n,e+1,d,"increase").subscribe({next:i=>{console.log("\u2705 Quantity increased:",i),setTimeout(()=>this.loadPartsHistory(),500)},error:i=>{console.error("\u274C Error increasing quantity:",i),alert("Error updating quantity: "+i.message)}})}decreaseQuantity(n,e){if(e<=0){alert("Mno\u017Estvo nem\xF4\u017Ee by\u0165 z\xE1porn\xE9");return}let d=prompt("D\xF4vod zn\xED\u017Eenia mno\u017Estva (POVINN\xC9 - napr. pou\u017Eit\xE9 pri oprave CNC Fr\xE9za):");if(!d||d.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zn\xED\u017Een\xED mno\u017Estva");return}console.log("\u2796 Decreasing quantity for part:",n),this.dataService.updatePartQuantity(n,e-1,d,"decrease").subscribe({next:i=>{console.log("\u2705 Quantity decreased:",i),setTimeout(()=>this.loadPartsHistory(),500)},error:i=>{console.error("\u274C Error decreasing quantity:",i),alert("Error updating quantity: "+i.message)}})}setQuantity(n,e){let d=prompt("Zadajte nov\xE9 mno\u017Estvo:");if(d===null)return;let i=parseInt(d);if(isNaN(i)||i<0){alert("Zadajte platn\xE9 kladn\xE9 \u010D\xEDslo");return}let s=prompt("D\xF4vod zmeny mno\u017Estva (POVINN\xC9 - napr. invent\xFAra, korekcia):");if(!s||s.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zmene mno\u017Estva");return}console.log("\u270F\uFE0F Setting quantity for part:",n,"to",i),this.dataService.updatePartQuantity(n,i,s,"set").subscribe({next:b=>{console.log("\u2705 Quantity set:",b),setTimeout(()=>this.loadPartsHistory(),500)},error:b=>{console.error("\u274C Error setting quantity:",b),alert("Error updating quantity: "+b.message)}})}addPart(n){n.preventDefault();let e=n.target,d=new FormData(e),i=d.get("deviceId"),s=i?this.devices().find(v=>v.id===i):void 0,b={name:d.get("name"),sku:d.get("sku"),quantity:parseInt(d.get("quantity")),minQuantity:parseInt(d.get("minQuantity"))||10,location:d.get("location"),deviceId:i||void 0,deviceName:s?.name||void 0};console.log("\u{1F504} Adding new part:",b),this.dataService.addPart(b).subscribe({next:v=>{console.log("\u2705 Part added successfully:",v),this.showAddForm.set(!1),e.reset(),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after adding new part"),this.loadPartsHistory()})},error:v=>{console.error("\u274C Error adding part:",v);let w="Chyba pri prid\xE1van\xED dielu";v.message&&(v.message.includes("SKU u\u017E existuje")?w="SKU u\u017E existuje v datab\xE1ze. Zadajte jedine\u010Dn\xE9 SKU.":w=v.message),alert(w)}})}deletePart(n,e){let d=`Naozaj chcete vymaza\u0165 n\xE1hradn\xFD diel "${e}"?

T\xE1to akcia sa ned\xE1 vr\xE1ti\u0165 sp\xE4\u0165 a vyma\u017Ee aj v\u0161etku hist\xF3riu zmien tohto dielu.`;confirm(d)&&(console.log("\u{1F5D1}\uFE0F Deleting part:",n),this.dataService.deletePart(n).subscribe({next:()=>{console.log("\u2705 Part deleted successfully"),alert(`N\xE1hradn\xFD diel "${e}" bol \xFAspe\u0161ne vymazan\xFD.`),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after deletion"),this.loadPartsHistory()})},error:i=>{console.error("\u274C Error deleting part:",i),alert(`Chyba pri vymaz\xE1van\xED dielu: ${i.message}`)}}))}};E.\u0275fac=function(e){return new(e||E)},E.\u0275cmp=q({type:E,selectors:[["app-part-list"]],decls:26,vars:19,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-semibold","text-gray-800"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors"],[1,"bg-white","p-6","rounded-lg","shadow-md","mb-6"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"mb-4","flex","gap-4"],["type","text","placeholder","H\u013Eada\u0165 diely (n\xE1zov, SKU, umiestnenie, zariadenie)...",1,"flex-1","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input"],[1,"px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change"],["value","all"],["value","below-min"],["value","low"],["value","ok"],[1,"overflow-x-auto"],[1,"w-full","text-left"],[1,"text-center","py-10"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"click"],[1,"text-xl","font-semibold","mb-4"],[3,"submit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","name","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","sku","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","number","name","quantity","required","","min","0",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","number","name","minQuantity","required","","min","0","value","10",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","location","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],[1,"md:col-span-2"],["name","deviceId",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["value",""],[3,"value"],[1,"text-xs","text-gray-500","mt-1"],[1,"mt-4","flex","justify-end","gap-2"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700"],[1,"text-xs","text-gray-500","uppercase","border-b"],[1,"py-3","px-4"],[1,"py-3","px-4","text-right"],[1,"py-3","px-4","text-center"],[1,"divide-y"],[1,"hover:bg-gray-50"],[1,"py-3","px-4","font-medium","text-gray-800"],[1,"py-3","px-4","text-gray-600"],[1,"inline-block","px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded"],[1,"text-gray-400","text-sm"],[1,"font-semibold"],[1,"text-xs","text-red-600"],[1,"py-3","px-4","text-right","text-gray-600"],[1,"py-3","px-4","text-xs"],[1,"space-y-1"],[1,"text-gray-400"],[1,"flex","items-center","justify-center","gap-2"],["title","Zn\xED\u017Ei\u0165 mno\u017Estvo",1,"px-2","py-1","bg-red-500","text-white","rounded","hover:bg-red-600","text-sm",3,"click"],["title","Zv\xFD\u0161i\u0165 mno\u017Estvo",1,"px-2","py-1","bg-green-500","text-white","rounded","hover:bg-green-600","text-sm",3,"click"],[1,"text-blue-600","text-xs"],[1,"text-gray-600"],[1,"text-gray-500"],[1,"text-blue-600","italic"],[1,"inline-block","px-2","py-0.5","rounded","text-xs",3,"ngClass"],["title","Nastavi\u0165 mno\u017Estvo",1,"px-2","py-1","bg-gray-500","text-white","rounded","hover:bg-gray-600","text-sm",3,"click"],["title","Vymaza\u0165 diel",1,"px-2","py-1","bg-red-700","text-white","rounded","hover:bg-red-800","text-sm",3,"click"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"h1",1),r(2),p(3,"translate"),t(),x(4,K,3,3,"button",2),t(),x(5,Y,46,18,"div",3),a(6,"div",4)(7,"div",5)(8,"input",6),_("input",function(s){return d.onSearch(s)}),t(),a(9,"select",7),_("change",function(s){return d.onFilterChange(s)}),a(10,"option",8),r(11),p(12,"translate"),t(),a(13,"option",9),r(14),p(15,"translate"),t(),a(16,"option",10),r(17),p(18,"translate"),t(),a(19,"option",11),r(20),p(21,"translate"),t()()(),a(22,"div",12),x(23,oe,27,15,"table",13)(24,le,4,3,"div",14),x(25,de,4,3,"div",14),t()()),e&2&&(o(2),c(m(3,9,"SPARE_PARTS_INVENTORY")),o(2),g(d.authService.isAdmin()?4:-1),o(),g(d.showAddForm()?5:-1),o(6),c(m(12,11,"FILTER_ALL_PARTS")),o(3),c(m(15,13,"FILTER_BELOW_MIN")),o(3),c(m(18,15,"FILTER_LOW_STOCK")),o(3),c(m(21,17,"FILTER_NORMAL_STOCK")),o(3),g(d.parts().length>0?23:24),o(2),g(d.filteredParts().length===0&&d.parts().length>0?25:-1))},dependencies:[H,V,M,O],encapsulation:2,changeDetection:0});var $=E;export{$ as PartListComponent};
