import{a as te}from"./chunk-A5RHXXN3.js";import{a as J}from"./chunk-LJTMCLK2.js";import{b as H,c as W,e as X,f as Z}from"./chunk-GPJ2JTKW.js";import{a as ie}from"./chunk-DGAYQE72.js";import{a as ee}from"./chunk-EI4TP4WW.js";import{Aa as T,Ca as n,Jb as c,Ka as $,Kb as p,Oa as N,Ob as A,Qb as K,S as h,X as f,Y as E,Z as U,Za as x,_ as P,_a as g,ab as R,ac as M,bb as F,cb as j,db as w,eb as o,fb as i,gb as _,hb as q,ib as Y,jb as Q,kb as D,lb as G,mb as C,o as O,ob as m,sb as S,vb as z,wb as r,xb as v,yb as s,zb as V}from"./chunk-GZNOUR2G.js";import"./chunk-K5CSBBV3.js";var y=class y{constructor(t){this.sanitizer=t;this.data=K.required();this.qrCodeUrl=A(()=>{let e=`https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(this.data())}`;return console.log("\u{1F4CA} Generated QR code URL:",e),this.sanitizer.bypassSecurityTrustUrl(e)});console.log("\u{1F532} QR Code component initialized")}};y.\u0275fac=function(e){return new(e||y)($(H))},y.\u0275cmp=N({type:y,selectors:[["app-qr-code"]],inputs:{data:[1,"data"]},decls:2,vars:1,consts:[[1,"p-2","bg-white","inline-block","rounded-lg","shadow-inner"],["alt","QR Code",1,"w-40","h-40",2,"image-rendering","pixelated",3,"src"]],template:function(e,a){e&1&&(q(0,"div",0),Q(1,"img",1),Y()),e&2&&(n(),G("src",a.qrCodeUrl(),T))},dependencies:[M],encapsulation:2,changeDetection:0});var B=y;function re(l,t){if(l&1&&(o(0,"div",19)(1,"h2",20),r(2,"Fotka zariadenia"),i(),_(3,"img",45),i()),l&2){let e=m();n(3),w("src",e.imageUrl,T)("alt",e.name)}}function le(l,t){if(l&1&&(o(0,"div")(1,"strong",22),r(2,"V\xFDrobca:"),i(),r(3),i()),l&2){let e=m();n(3),s(" ",e.manufacturer)}}function de(l,t){if(l&1&&(o(0,"div",48)(1,"strong",22),r(2),i(),o(3,"span",49),r(4),i()()),l&2){let e=t.$implicit,a=m(2);n(2),s("",e,":"),n(2),v(a.specifications[e])}}function ce(l,t){if(l&1&&(o(0,"div",19)(1,"h2",20),r(2),c(3,"translate"),i(),o(4,"div",46)(5,"div",47),F(6,de,5,2,"div",48,R),i()()()),l&2){let e=m(),a=m();n(2),s("\u{1F4CB} ",p(3,1,"SPECIFICATIONS")),n(4),j(a.objectKeys(e.specifications))}}function pe(l,t){l&1&&(o(0,"span",51),r(1,"\u26A0\uFE0F"),i())}function se(l,t){l&1&&(o(0,"span",51),r(1,"\u23F0"),i())}function me(l,t){if(l&1&&(o(0,"div",23)(1,"div",50)(2,"div")(3,"strong",22),r(4),c(5,"translate"),i(),o(6,"p",49),r(7),i()(),o(8,"div")(9,"strong",22),r(10),c(11,"translate"),i(),o(12,"p",49),r(13),c(14,"translate"),c(15,"translate"),i()(),o(16,"div")(17,"strong",22),r(18),c(19,"translate"),i(),o(20,"p",49),r(21),x(22,pe,2,0,"span",51)(23,se,2,0,"span",51),i()()()()),l&2){let e=m(),a=m();n(4),s("",p(5,10,"INSPECTION_DATE"),":"),n(3),v(e.electricalInspectionDate),n(3),s("",p(11,12,"VALIDITY"),":"),n(3),V("",e.electricalInspectionPeriod," ",e.electricalInspectionPeriod===1?p(14,14,"YEAR"):p(15,16,"YEARS")),n(5),s("",p(19,18,"EXPIRATION"),":"),n(2),z(a.getInspectionExpiryClass(e.electricalInspectionExpiry)),n(),s(" ",e.electricalInspectionExpiry," "),n(),g(a.isInspectionExpired(e.electricalInspectionExpiry)?22:a.isInspectionExpiringSoon(e.electricalInspectionExpiry)?23:-1)}}function ue(l,t){if(l&1){let e=D();o(0,"div",24)(1,"div")(2,"label",25),r(3),c(4,"translate"),i(),_(5,"input",52,4),i(),o(7,"div")(8,"label",25),r(9),c(10,"translate"),i(),o(11,"select",53,5)(13,"option",54),r(14),c(15,"translate"),i(),o(16,"option",55),r(17),c(18,"translate"),i(),o(19,"option",56),r(20),c(21,"translate"),i(),o(22,"option",57),r(23),c(24,"translate"),i(),o(25,"option",58),r(26),c(27,"translate"),i(),o(28,"option",59),r(29),c(30,"translate"),i()()(),o(31,"button",60),C("click",function(){f(e);let d=S(6),u=S(12),b=m(2);return E(b.updateElectricalInspection(d.value,+u.value))}),r(32),c(33,"translate"),i()()}l&2&&(n(3),s("",p(4,9,"INSPECTION_DATE")," *"),n(6),s("",p(10,11,"VALIDITY")," *"),n(5),s("1 ",p(15,13,"YEAR")),n(3),s("2 ",p(18,15,"YEARS")),n(3),s("3 ",p(21,17,"YEARS")),n(3),s("4 ",p(24,19,"YEARS")),n(3),s("5 ",p(27,21,"YEARS")),n(3),s("10 ",p(30,23,"YEARS")),n(3),s(" \u{1F4BE} ",p(33,25,"SAVE_INSPECTION")," "))}function ve(l,t){if(l&1&&_(0,"app-qr-code",38),l&2){let e=m(2);w("data",e.qrCodeData())}}function xe(l,t){if(l&1){let e=D();o(0,"button",61),C("click",function(){f(e);let d=m(2);return E(d.updateStatus("maintenance"))}),r(1),c(2,"translate"),i(),o(3,"button",62),C("click",function(){f(e);let d=m(2);return E(d.updateStatus("offline"))}),r(4),c(5,"translate"),i()}l&2&&(n(),v(p(2,2,"SET_STATUS_MAINTENANCE")),n(3),v(p(5,4,"SET_STATUS_OFFLINE")))}function ge(l,t){if(l&1){let e=D();o(0,"button",63),C("click",function(){f(e);let d=m(2);return E(d.updateStatus("operational"))}),r(1),c(2,"translate"),i()}l&2&&(n(),v(p(2,1,"SET_STATUS_OPERATIONAL")))}function _e(l,t){if(l&1&&(o(0,"a",43),r(1),c(2,"translate"),i()),l&2){let e=m();w("href",e.manualUrl,T),n(),s(" \u{1F4C4} ",p(2,2,"VIEW_MANUAL")," ")}}function fe(l,t){l&1&&(o(0,"div",44),r(1," Manu\xE1l nie je k dispoz\xEDcii "),i())}function Ee(l,t){if(l&1){let e=D();o(0,"div",64)(1,"label",65)(2,"span",66),r(3,"Nahra\u0165 manu\xE1l (PDF)"),i(),o(4,"input",67,6),C("change",function(d){f(e);let u=m(2);return E(u.uploadManual(d))}),i()()(),o(6,"button",68),C("click",function(){f(e);let d=m(2);return E(d.decommissionDevice())}),r(7),c(8,"translate"),i()}l&2&&(n(7),v(p(8,1,"DECOMMISSION_DEVICE")))}function Ce(l,t){if(l&1){let e=D();o(0,"div",8)(1,"a",9),U(),o(2,"svg",10),_(3,"path",11),i(),r(4),c(5,"translate"),i()(),P(),o(6,"div",12)(7,"div",13)(8,"div",14)(9,"div",15)(10,"div")(11,"h1",16),r(12),i(),o(13,"p",17),r(14),i()(),o(15,"span",18),r(16),c(17,"translate"),i()(),x(18,re,4,2,"div",19),o(19,"div",19)(20,"h2",20),r(21),c(22,"translate"),i(),o(23,"div",21)(24,"div")(25,"strong",22),r(26),c(27,"translate"),i(),r(28),i(),x(29,le,4,1,"div"),o(30,"div")(31,"strong",22),r(32),c(33,"translate"),i(),r(34),i(),o(35,"div")(36,"strong",22),r(37),c(38,"translate"),i(),r(39),i(),o(40,"div")(41,"strong",22),r(42),c(43,"translate"),i(),r(44),i(),o(45,"div")(46,"strong",22),r(47),c(48,"translate"),i(),r(49),i()()(),x(50,ce,8,3,"div",19),o(51,"div",19)(52,"h2",20),r(53),c(54,"translate"),i(),x(55,me,24,20,"div",23),x(56,ue,34,27,"div",24),i(),o(57,"div",19)(58,"h2",20),r(59),c(60,"translate"),i(),o(61,"div",24)(62,"div")(63,"label",25),r(64,"Typ \xFAdr\u017Eby"),i(),o(65,"div",26)(66,"label",27),_(67,"input",28,0),o(69,"span",29),r(70,"\u{1F4C5} Pl\xE1novan\xE1 \xFAdr\u017Eba"),i()(),o(71,"label",27),_(72,"input",30,1),o(74,"span",29),r(75,"\u{1F6A8} Neodkladn\xE1 \xFAdr\u017Eba"),i()()()(),o(76,"div")(77,"label",25),r(78,"Trvanie \xFAdr\u017Eby (min\xFAty) *"),i(),_(79,"input",31,2),o(81,"p",32),r(82,"Minim\xE1lne trvanie: 15 min\xFAt"),i()(),_(83,"textarea",33,3),c(85,"translate"),o(86,"button",34),C("click",function(){f(e);let d=S(68),u=S(80),b=S(84);return m().logMaintenance(b.value,d.checked?"scheduled":"emergency",+u.value),b.value="",u.value="30",E(d.checked=!0)}),r(87),c(88,"translate"),i()()()()(),o(89,"div",35)(90,"div",36)(91,"h2",20),r(92),c(93,"translate"),i(),o(94,"div",37),x(95,ve,1,1,"app-qr-code",38),i(),o(96,"p",39),r(97),c(98,"translate"),i(),o(99,"div",40)(100,"h3",41),r(101),c(102,"translate"),i(),x(103,xe,6,6)(104,ge,3,3,"button",42),x(105,_e,3,4,"a",43)(106,fe,2,0,"div",44),x(107,Ee,9,3),i()()()()}if(l&2){let e,a=t,d=m();n(4),s(" ",p(5,34,"BACK_TO_DEVICES")," "),n(8),v(a.name),n(2),V("",a.type," - ",a.location),n(),z(d.getStatusClass(a.status)),n(),s(" ",p(17,36,"STATUS_"+a.status.toUpperCase())," "),n(2),g(a.imageUrl?18:-1),n(3),v(p(22,38,"DEVICE_DETAILS")),n(5),s("",p(27,40,"DEVICE_ID"),":"),n(2),s(" ",a.id),n(),g(a.manufacturer?29:-1),n(3),s("",p(33,42,"LOCATION"),":"),n(2),s(" ",a.location),n(3),s("",p(38,44,"LAST_MAINTENANCE"),":"),n(2),s(" ",a.lastMaintenance),n(3),s("",p(43,46,"NEXT_MAINTENANCE"),":"),n(2),s(" ",a.nextMaintenance),n(3),s("",p(48,48,"DOWNTIME"),":"),n(2),s(" ",a.downtime,"h"),n(),g(a.specifications&&d.objectKeys(a.specifications).length>0?50:-1),n(3),s("\u26A1 ",p(54,50,"ELECTRICAL_INSPECTION")),n(2),g(a.electricalInspectionDate&&a.electricalInspectionExpiry?55:-1),n(),g(((e=d.authService.currentUser())==null?null:e.role)==="admin"?56:-1),n(3),v(p(60,52,"LOG_MAINTENANCE")),n(24),w("placeholder",p(85,54,"MAINTENANCE_NOTES_PLACEHOLDER")),n(4),v(p(88,56,"COMPLETE_LOG_MAINTENANCE")),n(5),v(p(93,58,"DEVICE_QR_CODE")),n(3),g(d.qrCodeData()?95:-1),n(2),v(p(98,60,"SCAN_QR_CODE_INFO")),n(4),v(p(102,62,"ACTIONS")),n(2),g(a.status==="operational"?103:104),n(2),g(a.manualUrl&&!a.manualUrl.includes("example.com")?105:106),n(2),g(d.authService.isAdmin()?107:-1)}}function be(l,t){l&1&&(o(0,"div",7)(1,"p",17),r(2),c(3,"translate"),i()()),l&2&&(n(2),v(p(3,1,"LOADING_DEVICE_DETAILS")))}var I=class I{constructor(){this.route=h(W);this.router=h(X);this.dataService=h(ie);this.authService=h(J);this.allDevices=this.dataService.getDevicesSignal();this.deviceId=te(this.route.paramMap.pipe(O(t=>t.get("id"))));this.device=A(()=>{let t=this.deviceId();if(t)return this.allDevices().find(e=>e.id===t)});this.qrCodeData=A(()=>{let t=this.device();return t?`Device ID: ${t.id}
Name: ${t.name}
Location: ${t.location}`:""})}getStatusClass(t){switch(t){case"operational":return"bg-green-100 text-green-800";case"maintenance":return"bg-yellow-100 text-yellow-800";case"offline":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}logMaintenance(t,e,a){let d=this.device(),u=this.authService.currentUser();if(!d||!u)return;if(!t||t.trim()===""){alert("Pros\xEDm zadajte pozn\xE1mky k \xFAdr\u017Ebe.");return}if(!a||a<15){alert("Minim\xE1lne trvanie \xFAdr\u017Eby je 15 min\xFAt.");return}let b=e==="scheduled"?"\u{1F4C5} Pl\xE1novan\xE1":"\u{1F6A8} Neodkladn\xE1",L=(a/60).toFixed(1);console.log(`\u{1F4DD} Logging ${e} maintenance for device:`,d.name,"Duration:",a,"minutes"),this.dataService.addMaintenanceLog({deviceId:d.id,deviceName:d.name,date:new Date().toISOString().split("T")[0],technician:u.email,notes:t.trim(),type:e,durationMinutes:a}).subscribe({next:k=>{console.log("\u2705 Maintenance log saved:",k),alert(`\xDAdr\u017Eba zariadenia "${d.name}" bola \xFAspe\u0161ne zaznamenan\xE1.

Typ: ${b}
Technik: ${u.email}
D\xE1tum: ${new Date().toLocaleDateString("sk-SK")}
Trvanie: ${a} min\xFAt (${L}h)

Pozn\xE1mky: ${t.trim()}`)},error:k=>{console.error("\u274C Error logging maintenance:",k),alert(`Chyba pri zaznamen\xE1van\xED \xFAdr\u017Eby: ${k.message}`)}})}updateStatus(t){let e=this.device();e&&(console.log("\u{1F504} Updating device status to:",t),this.dataService.updateDeviceStatus(e.id,t).subscribe({next:a=>console.log("\u2705 Device status updated:",a),error:a=>console.error("\u274C Error updating status:",a)}))}decommissionDevice(){let t=this.device();if(!t)return;let e=`Naozaj chcete vyradi\u0165 zariadenie "${t.name}"? T\xE1to akcia sa ned\xE1 vr\xE1ti\u0165 sp\xE4\u0165.`;confirm(e)&&(console.log("\u{1F5D1}\uFE0F Decommissioning device:",t.id),this.dataService.deleteDevice(t.id).subscribe({next:()=>{console.log("\u2705 Device successfully decommissioned"),alert(`Zariadenie "${t.name}" bolo \xFAspe\u0161ne vyraden\xE9.`),this.router.navigate(["/devices"])},error:a=>{console.error("\u274C Error decommissioning device:",a),alert(`Chyba pri vyra\u010Fovan\xED zariadenia: ${a.message}`)}}))}uploadManual(t){let e=t.target,a=this.device();if(!e.files||e.files.length===0||!a)return;let d=e.files[0];if(d.type!=="application/pdf"){alert("M\xF4\u017Eete nahra\u0165 len PDF s\xFAbory."),e.value="";return}if(d.size>10*1024*1024){alert("S\xFAbor je pr\xEDli\u0161 ve\u013Ek\xFD. Maxim\xE1lna ve\u013Ekos\u0165 je 10MB."),e.value="";return}console.log("\u{1F4E4} Uploading manual:",d.name),this.dataService.uploadDeviceManual(a.id,d).subscribe({next:u=>{console.log("\u2705 Manual uploaded successfully:",u),alert(`Manu\xE1l "${d.name}" bol \xFAspe\u0161nenahran\xFD.`),e.value=""},error:u=>{console.error("\u274C Error uploading manual:",u),alert(`Chyba pri nahr\xE1van\xED manu\xE1lu: ${u.message}`),e.value=""}})}updateElectricalInspection(t,e){let a=this.device();if(a){if(!t||t.trim()===""){alert("Pros\xEDm zadajte d\xE1tum rev\xEDzie.");return}if(![1,2,3,4,5,10].includes(e)){alert("Pros\xEDm vyberte platn\xFA peri\xF3du.");return}console.log("\u26A1 Updating electrical inspection:",t,e),this.dataService.updateElectricalInspection(a.id,t,e).subscribe({next:d=>{console.log("\u2705 Electrical inspection updated:",d),alert(`Elektrick\xE1 rev\xEDzia zariadenia "${a.name}" bola \xFAspe\u0161ne aktualizovan\xE1.

D\xE1tum: ${t}
Platnos\u0165: ${e} ${e===1?"rok":e<5?"roky":"rokov"}
Expir\xE1cia: ${d.electricalInspectionExpiry}`)},error:d=>{console.error("\u274C Error updating electrical inspection:",d),alert(`Chyba pri aktualiz\xE1cii rev\xEDzie: ${d.message}`)}})}}isInspectionExpired(t){return t?new Date(t)<new Date:!1}isInspectionExpiringSoon(t){if(!t)return!1;let e=new Date(t),a=new Date,d=Math.floor((e.getTime()-a.getTime())/(1e3*60*60*24));return d>0&&d<=30}getInspectionExpiryClass(t){return this.isInspectionExpired(t)?"text-red-600 font-bold":this.isInspectionExpiringSoon(t)?"text-yellow-600 font-bold":"text-green-600"}objectKeys(t){return Object.keys(t)}};I.\u0275fac=function(e){return new(e||I)},I.\u0275cmp=N({type:I,selectors:[["app-device-detail"]],decls:2,vars:1,consts:[["typeScheduled",""],["typeEmergency",""],["duration",""],["notes",""],["inspectionDate",""],["inspectionPeriod",""],["fileInput",""],[1,"text-center","py-10"],[1,"mb-4"],["routerLink","/devices",1,"text-blue-600","hover:underline","flex","items-center"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"flex","justify-between","items-start"],[1,"text-3xl","font-bold","text-gray-800"],[1,"text-gray-500"],[1,"px-3","py-1","text-sm","font-semibold","rounded-full","capitalize"],[1,"mt-6","border-t","pt-6"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm"],[1,"text-gray-600"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-4"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","gap-4"],[1,"flex","items-center","cursor-pointer"],["type","radio","name","maintenanceType","value","scheduled","checked","",1,"mr-2"],[1,"text-sm"],["type","radio","name","maintenanceType","value","emergency",1,"mr-2"],["type","number","min","15","step","5","value","30","required","","placeholder","Minim\xE1lne 15 min\xFAt",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"text-xs","text-gray-500","mt-1"],["rows","4",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"placeholder"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"click"],[1,"lg:col-span-1"],[1,"bg-white","p-6","rounded-lg","shadow-md","text-center"],[1,"flex","justify-center"],[3,"data"],[1,"mt-4","text-xs","text-gray-500"],[1,"mt-6","border-t","pt-6","space-y-3"],[1,"text-lg","font-semibold","text-gray-700"],[1,"w-full","px-4","py-2","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors"],["target","_blank",1,"block","w-full","text-center","px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"href"],[1,"text-center","text-gray-400","text-sm","py-2"],[1,"max-w-full","h-auto","rounded-lg","shadow-md","max-h-96","object-cover",3,"src","alt"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3","text-sm"],[1,"flex","justify-between","border-b","border-gray-200","pb-2"],[1,"text-gray-800"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","text-sm"],[1,"ml-1"],["type","date",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["value","10"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-yellow-500","text-white","rounded-md","hover:bg-yellow-600","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-gray-500","text-white","rounded-md","hover:bg-gray-600","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors",3,"click"],[1,"border-t","pt-3"],[1,"block","w-full"],[1,"text-xs","text-gray-600","mb-1","block"],["type","file","accept","application/pdf",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded","file:border-0","file:text-sm","file:font-semibold","file:bg-blue-50","file:text-blue-700","hover:file:bg-blue-100","cursor-pointer",3,"change"],[1,"w-full","px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","transition-colors",3,"click"]],template:function(e,a){if(e&1&&x(0,Ce,108,64)(1,be,4,3,"div",7),e&2){let d;g((d=a.device())?0:1,d)}},dependencies:[M,Z,B,ee],encapsulation:2,changeDetection:0});var ne=I;export{ne as DeviceDetailComponent};
