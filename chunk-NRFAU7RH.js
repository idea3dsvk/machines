import{f as K}from"./chunk-LJDWDV4F.js";import{a as Q}from"./chunk-WNUU5OWS.js";import{a as J}from"./chunk-GXGFOH63.js";import{$a as q,Ca as r,Eb as $,Hb as W,Jb as l,Kb as d,N as j,Oa as Y,Ob as Z,S as B,X as _,Y as y,Z as R,Za as T,_ as H,_a as L,ac as X,bb as O,cb as P,db as F,ea as k,eb as t,fb as e,gb as f,kb as U,mb as E,ob as S,vb as G,wb as a,xb as s,yb as A}from"./chunk-ONBGLYDQ.js";import{a as M,b as V}from"./chunk-K5CSBBV3.js";var h=class h{exportDevicesToCsv(i,n="devices-export.csv"){if(!i||i.length===0){console.warn("No devices to export");return}let o=["ID zariadenia","N\xE1zov","Typ","Umiestnenie","V\xFDrobca","Stav","\u0160pecifik\xE1cie"],p=i.map(v=>{let w="";return v.specifications&&(w=Object.entries(v.specifications).map(([x,u])=>`${x}: ${u}`).join("; ")),[this.escapeCSV(v.id),this.escapeCSV(v.name),this.escapeCSV(v.type),this.escapeCSV(v.location),this.escapeCSV(v.manufacturer||"-"),this.escapeCSV(this.getStatusLabel(v.status)),this.escapeCSV(w||"-")]}),m=[o.join(","),...p.map(v=>v.join(","))].join(`
`),g="\uFEFF",I=new Blob([g+m],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a"),D=URL.createObjectURL(I);b.setAttribute("href",D),b.setAttribute("download",n),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(D),console.log(`\u2705 Exported ${i.length} devices to ${n}`)}escapeCSV(i){return i.includes(",")||i.includes('"')||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i}getStatusLabel(i){switch(i){case"operational":return"V prev\xE1dzke";case"maintenance":return"V \xFAdr\u017Ebe";case"offline":return"Mimo prev\xE1dzky";default:return i}}};h.\u0275fac=function(n){return new(n||h)},h.\u0275prov=j({token:h,factory:h.\u0275fac,providedIn:"root"});var N=h;var ne=c=>["/devices",c],ae=(c,i)=>i.id;function re(c,i){if(c&1){let n=U();t(0,"div",45)(1,"input",50),l(2,"translate"),E("input",function(p){let m=_(n).$index,g=S(2);return y(g.updateSpecificationKey(m,p))}),e(),t(3,"input",50),l(4,"translate"),E("input",function(p){let m=_(n).$index,g=S(2);return y(g.updateSpecificationValue(m,p))}),e(),t(5,"button",51),E("click",function(){let p=_(n).$index,m=S(2);return y(m.removeSpecificationField(p))}),a(6," \u2715 "),e()()}if(c&2){let n=i.$implicit;r(),F("placeholder",$(d(2,6,"SPEC_KEY_PLACEHOLDER")))("value",n.key),r(2),F("placeholder",$(d(4,8,"SPEC_VALUE_PLACEHOLDER")))("value",n.value)}}function oe(c,i){c&1&&(t(0,"p",46),a(1),l(2,"translate"),e()),c&2&&(r(),s(d(2,1,"NO_SPECIFICATIONS")))}function le(c,i){if(c&1){let n=U();t(0,"div",7)(1,"h2",14),a(2,"Prida\u0165 nov\xE9 zariadenie"),e(),t(3,"form",15),E("submit",function(p){_(n);let m=S();return y(m.addDevice(p))}),t(4,"div",16)(5,"div")(6,"label",17),a(7,"ID zariadenia *"),e(),f(8,"input",18),t(9,"p",19),a(10,"Unik\xE1tny identifik\xE1tor pre QR k\xF3d a evidenciu"),e()(),t(11,"div")(12,"label",17),a(13,"N\xE1zov zariadenia *"),e(),f(14,"input",20),e(),t(15,"div")(16,"label",17),a(17,"Typ *"),e(),f(18,"input",21),e(),t(19,"div")(20,"label",17),a(21,"V\xFDrobca"),e(),f(22,"input",22),e(),t(23,"div")(24,"label",17),a(25,"Umiestnenie *"),e(),f(26,"input",23),e(),t(27,"div")(28,"label",17),a(29,"Stav"),e(),t(30,"select",24)(31,"option",25),a(32),l(33,"translate"),e(),t(34,"option",26),a(35),l(36,"translate"),e(),t(37,"option",27),a(38),l(39,"translate"),e()()(),t(40,"div")(41,"label",17),a(42,"Posledn\xE1 \xFAdr\u017Eba *"),e(),f(43,"input",28),e(),t(44,"div")(45,"label",17),a(46),l(47,"translate"),e(),t(48,"select",29)(49,"option",30),a(50),l(51,"translate"),e(),t(52,"option",31),a(53),l(54,"translate"),e(),t(55,"option",32),a(56),l(57,"translate"),e(),t(58,"option",33),a(59),l(60,"translate"),e(),t(61,"option",34),a(62),l(63,"translate"),e()(),t(64,"p",19),a(65),l(66,"translate"),e()(),t(67,"div")(68,"label",17),a(69),l(70,"translate"),e(),f(71,"input",35),t(72,"p",19),a(73),l(74,"translate"),e()(),t(75,"div",36)(76,"label",17),a(77,"Fotka zariadenia"),e(),f(78,"input",37),t(79,"p",19),a(80,"Maxim\xE1lna ve\u013Ekos\u0165: 5 MB. Form\xE1ty: JPG, PNG, WebP"),e()(),t(81,"div",36)(82,"label",17),a(83,"URL manu\xE1lu"),e(),f(84,"input",38),e(),t(85,"div",39)(86,"div",40)(87,"label",41),a(88),l(89,"translate"),e(),t(90,"button",42),E("click",function(){_(n);let p=S();return y(p.addSpecificationField())}),a(91),l(92,"translate"),e()(),t(93,"p",43),a(94),l(95,"translate"),e(),t(96,"div",44),O(97,re,7,10,"div",45,q),T(99,oe,3,3,"p",46),e()()(),t(100,"div",47)(101,"button",48),E("click",function(){_(n);let p=S();return y(p.toggleAddForm())}),a(102," Zru\u0161i\u0165 "),e(),t(103,"button",49),a(104," Prida\u0165 zariadenie "),e()()()()}if(c&2){let n=S();r(32),s(d(33,16,"STATUS_OPERATIONAL")),r(3),s(d(36,18,"STATUS_MAINTENANCE")),r(3),s(d(39,20,"STATUS_OFFLINE")),r(8),s(d(47,22,"MAINTENANCE_PERIOD")),r(4),s(d(51,24,"SELECT_PERIOD")),r(3),s(d(54,26,"MONTHLY")),r(3),s(d(57,28,"QUARTERLY")),r(3),s(d(60,30,"SEMI_ANNUALLY")),r(3),s(d(63,32,"ANNUALLY")),r(3),s(d(66,34,"AUTO_CALCULATES_NEXT")),r(4),s(d(70,36,"NEXT_MAINTENANCE")),r(4),s(d(74,38,"CALCULATED_AUTOMATICALLY")),r(15),s(d(89,40,"SPECIFICATIONS")),r(3),A(" + ",d(92,42,"ADD_FIELD")," "),r(3),s(d(95,44,"SPECIFICATIONS_HELP")),r(3),P(n.specificationFields()),r(2),L(n.specificationFields().length===0?99:-1)}}function de(c,i){if(c&1&&(t(0,"tr",55)(1,"td",56),a(2),e(),t(3,"td",57),a(4),e(),t(5,"td",57),a(6),e(),t(7,"td",53)(8,"span",58),a(9),l(10,"translate"),e()(),t(11,"td",57),a(12),e(),t(13,"td",57),a(14),e(),t(15,"td",59)(16,"a",60),a(17),l(18,"translate"),e()()()),c&2){let n=i.$implicit,o=S(2);r(2),s(n.name),r(2),s(n.type),r(2),s(n.location),r(2),G(o.getStatusClass(n.status)),r(),A(" ",d(10,10,"STATUS_"+n.status.toUpperCase())," "),r(3),s(n.downtime),r(2),s(n.nextMaintenance),r(2),F("routerLink",W(14,ne,n.id)),r(),s(d(18,12,"DETAILS"))}}function se(c,i){if(c&1&&(t(0,"table",12)(1,"thead")(2,"tr",52)(3,"th",53),a(4),l(5,"translate"),e(),t(6,"th",53),a(7),l(8,"translate"),e(),t(9,"th",53),a(10),l(11,"translate"),e(),t(12,"th",53),a(13),l(14,"translate"),e(),t(15,"th",53),a(16),l(17,"translate"),e(),t(18,"th",53),a(19),l(20,"translate"),e(),f(21,"th",53),e()(),t(22,"tbody",54),O(23,de,19,16,"tr",55,ae),e()()),c&2){let n=S();r(4),s(d(5,6,"DEVICE_NAME")),r(3),s(d(8,8,"TYPE")),r(3),s(d(11,10,"LOCATION")),r(3),s(d(14,12,"STATUS")),r(3),s(d(17,14,"DOWNTIME")),r(3),s(d(20,16,"NEXT_MAINTENANCE")),r(4),P(n.filteredDevices())}}function pe(c,i){c&1&&(t(0,"div",13)(1,"p",61),a(2),l(3,"translate"),e()()),c&2&&(r(2),s(d(3,1,"LOADING_DEVICES")))}function ce(c,i){c&1&&(t(0,"div",13)(1,"p",61),a(2),l(3,"translate"),e()()),c&2&&(r(2),s(d(3,1,"NO_DEVICES_FOUND")))}var C=class C{constructor(){this.dataService=B(Q);this.exportService=B(N);this.devices=this.dataService.getDevicesSignal();this.searchTerm=k("");this.showAddForm=k(!1);this.specificationFields=k([]);this.filteredDevices=Z(()=>{let i=this.searchTerm().toLowerCase();return i?this.devices().filter(n=>n.name.toLowerCase().includes(i)||n.type.toLowerCase().includes(i)||n.location.toLowerCase().includes(i)):this.devices()});this.dataService.loadDevices().subscribe()}addSpecificationField(){this.specificationFields.update(i=>[...i,{key:"",value:""}])}removeSpecificationField(i){this.specificationFields.update(n=>n.filter((o,p)=>p!==i))}updateSpecificationKey(i,n){let o=n.target;this.specificationFields.update(p=>{let m=[...p];return m[i]=V(M({},m[i]),{key:o.value}),m})}updateSpecificationValue(i,n){let o=n.target;this.specificationFields.update(p=>{let m=[...p];return m[i]=V(M({},m[i]),{value:o.value}),m})}onSearch(i){let n=i.target;this.searchTerm.set(n.value)}getStatusClass(i){switch(i){case"operational":return"bg-green-100 text-green-800";case"maintenance":return"bg-yellow-100 text-yellow-800";case"offline":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}toggleAddForm(){this.showAddForm.update(i=>!i)}addDevice(i){i.preventDefault();let n=i.target,o=new FormData(n),p=o.get("customId");if(this.devices().find(x=>x.id===p)){alert(`Zariadenie s ID "${p}" u\u017E existuje! Pou\u017Eite in\xE9 ID.`);return}let g=o.get("deviceImage");if(g&&g.size>0){if(g.size>5*1024*1024){alert("Fotka je pr\xEDli\u0161 ve\u013Ek\xE1! Maxim\xE1lna ve\u013Ekos\u0165 je 5 MB.");return}if(!g.type.startsWith("image/")){alert("Neplatn\xFD form\xE1t s\xFAboru! Nahrajte obr\xE1zok (JPG, PNG, WebP).");return}}let I=o.get("lastMaintenance"),b=o.get("maintenancePeriod"),D=o.get("nextMaintenance");if(I&&b){let x=new Date(I),u=new Date(x);switch(b){case"monthly":u.setMonth(u.getMonth()+1);break;case"quarterly":u.setMonth(u.getMonth()+3);break;case"semi-annually":u.setMonth(u.getMonth()+6);break;case"annually":u.setFullYear(u.getFullYear()+1);break}D=u.toISOString().split("T")[0]}let v={};this.specificationFields().forEach(x=>{if(x.key.trim()){let u=x.value.trim(),z=parseFloat(u.replace(",",".")),te=/^-?\d+([.,]\d+)?$/.test(u);v[x.key.trim()]=te&&!isNaN(z)?z:u}});let w={id:p,name:o.get("name"),type:o.get("type"),manufacturer:o.get("manufacturer")||void 0,location:o.get("location"),status:o.get("status")||"operational",manualUrl:o.get("manualUrl")||void 0,lastMaintenance:I,nextMaintenance:D,maintenancePeriod:b||void 0,specifications:Object.keys(v).length>0?v:void 0,downtime:0,lastStatusChange:new Date().toISOString()};console.log("Adding new device with custom ID:",w),this.dataService.addDevice(w).subscribe({next:x=>{console.log("\u2705 Device successfully added:",x),g&&g.size>0?(console.log("\u{1F4E4} Uploading device image..."),this.dataService.uploadDeviceImage(x.id,g).subscribe({next:u=>{console.log("\u2705 Image uploaded successfully:",u),n.reset(),this.showAddForm.set(!1),alert(`Zariadenie "${x.name}" bolo \xFAspe\u0161ne pridan\xE9 s fotkou!`)},error:u=>{console.error("\u274C Error uploading image:",u),n.reset(),this.showAddForm.set(!1),alert(`Zariadenie "${x.name}" bolo pridan\xE9, ale fotka sa nepodarila nahra\u0165: ${u.message}`)}})):(n.reset(),this.showAddForm.set(!1),this.specificationFields.set([]),alert(`Zariadenie "${x.name}" bolo \xFAspe\u0161ne pridan\xE9!`))},error:x=>{console.error("\u274C Error adding device:",x),alert(`Chyba pri prid\xE1van\xED zariadenia: ${x.message}`)}})}exportDevices(){let i=this.devices();if(i.length===0){alert("Nie s\xFA \u017Eiadne zariadenia na export.");return}let o=`zariadenia-export-${new Date().toISOString().split("T")[0]}.csv`;console.log(`\u{1F4E4} Exporting ${i.length} devices to ${o}`),this.exportService.exportDevicesToCsv(i,o),alert(`\xDAspe\u0161ne exportovan\xFDch ${i.length} zariaden\xED do s\xFAboru ${o}`)}};C.\u0275fac=function(n){return new(n||C)},C.\u0275cmp=Y({type:C,selectors:[["app-device-list"]],decls:22,vars:15,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-semibold","text-gray-800"],[1,"flex","gap-2"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","transition-colors","flex","items-center","gap-2",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"click"],[1,"bg-white","p-6","rounded-lg","shadow-md","mb-6"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"mb-4"],["type","text",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","placeholder"],[1,"overflow-x-auto"],[1,"w-full","text-left"],[1,"text-center","py-10"],[1,"text-xl","font-semibold","mb-4"],[3,"submit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","customId","required","","placeholder","napr. CNC-001, LASER-05",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],[1,"text-xs","text-gray-500","mt-1"],["type","text","name","name","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","type","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","manufacturer","placeholder","napr. Siemens, Fanuc, Haas",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","location","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["name","status",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["value","operational"],["value","maintenance"],["value","offline"],["type","date","name","lastMaintenance","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["name","maintenancePeriod",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["value",""],["value","monthly"],["value","quarterly"],["value","semi-annually"],["value","annually"],["type","date","name","nextMaintenance",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],[1,"md:col-span-2"],["type","file","name","deviceImage","accept","image/*",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","url","name","manualUrl","placeholder","https://...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],[1,"md:col-span-2","border-t","pt-4","mt-2"],[1,"flex","justify-between","items-center","mb-3"],[1,"block","text-sm","font-medium","text-gray-700"],["type","button",1,"text-sm","px-3","py-1","bg-green-600","text-white","rounded","hover:bg-green-700",3,"click"],[1,"text-xs","text-gray-500","mb-3"],[1,"space-y-2"],[1,"flex","gap-2","items-start"],[1,"text-sm","text-gray-400","italic"],[1,"mt-4","flex","justify-end","gap-2"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700"],["type","text",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"input","value","placeholder"],["type","button",1,"px-3","py-2","text-red-600","hover:bg-red-50","rounded",3,"click"],[1,"text-xs","text-gray-500","uppercase","border-b"],[1,"py-3","px-4"],[1,"divide-y"],[1,"hover:bg-gray-50"],[1,"py-3","px-4","font-medium","text-gray-800"],[1,"py-3","px-4","text-gray-600"],[1,"px-2","py-1","text-xs","font-semibold","rounded-full","capitalize"],[1,"py-3","px-4","text-right"],[1,"text-blue-600","hover:underline",3,"routerLink"],[1,"text-gray-500"]],template:function(n,o){n&1&&(t(0,"div",0)(1,"h1",1),a(2),l(3,"translate"),e(),t(4,"div",2)(5,"button",3),E("click",function(){return o.exportDevices()}),R(),t(6,"svg",4),f(7,"path",5),e(),a(8),l(9,"translate"),e(),H(),t(10,"button",6),E("click",function(){return o.toggleAddForm()}),a(11),l(12,"translate"),e()()(),T(13,le,105,46,"div",7),t(14,"div",8)(15,"div",9)(16,"input",10),l(17,"translate"),E("input",function(m){return o.onSearch(m)}),e()(),t(18,"div",11),T(19,se,25,18,"table",12)(20,pe,4,3,"div",13),T(21,ce,4,3,"div",13),e()()),n&2&&(r(2),s(d(3,7,"DEVICES")),r(6),A(" ",d(9,9,"EXPORT_DEVICES")," "),r(3),A(" ",o.showAddForm()?"CANCEL":d(12,11,"ADD_NEW_DEVICE")," "),r(2),L(o.showAddForm()?13:-1),r(3),F("placeholder",d(17,13,"SEARCH_DEVICES")),r(3),L(o.devices().length>0?19:20),r(2),L(o.filteredDevices().length===0&&o.devices().length>0?21:-1))},dependencies:[X,K,J],encapsulation:2,changeDetection:0});var ee=C;export{ee as DeviceListComponent};
