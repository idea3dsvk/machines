import{a as P}from"./chunk-E5UOQA7C.js";import{a as R}from"./chunk-6AKYKVHN.js";import{a as j}from"./chunk-7522RZT3.js";import{Ca as i,Jb as m,Kb as s,Oa as L,Ob as M,S as H,Z as h,Za as _,_ as S,_a as b,ac as G,bb as F,cb as k,ea as I,hb as e,ib as t,jb as v,lb as B,nb as V,ob as T,tb as A,vb as D,wb as o,xb as l,yb as c,zb as N}from"./chunk-XYNLGK6V.js";import"./chunk-K5CSBBV3.js";var W=(r,a)=>a.value,K=(r,a)=>a.device.id;function U(r,a){if(r&1&&(e(0,"option",5),o(1),t()),r&2){let n=a.$implicit;B("value",n.value),i(),l(n.label)}}function X(r,a){if(r&1&&(e(0,"span",53),o(1),t()),r&2){let n=T().$implicit;i(),c("\u{1F4C5} ",n.scheduledCount)}}function q(r,a){if(r&1&&(e(0,"span",54),o(1),t()),r&2){let n=T().$implicit;i(),c("\u{1F6A8} ",n.emergencyCount)}}function J(r,a){r&1&&(e(0,"span",55),o(1,"-"),t())}function Q(r,a){r&1&&(o(0),m(1,"translate")),r&2&&c(" \u26A0\uFE0F ",s(1,1,"OVER_TARGET")," ")}function Z(r,a){r&1&&(o(0),m(1,"translate")),r&2&&c(" \u2713 ",s(1,1,"IN_TARGET")," ")}function ee(r,a){if(r&1&&(e(0,"tr",38)(1,"td",47)(2,"div",48),o(3),t(),e(4,"div",49),o(5),t()(),e(6,"td",50),o(7),t(),e(8,"td",51)(9,"div",52),_(10,X,2,1,"span",53),_(11,q,2,1,"span",54),_(12,J,2,0,"span",55),t()(),e(13,"td",56)(14,"div",57),o(15),t(),e(16,"div",49),o(17),t()(),e(18,"td",56)(19,"div",58),o(20),t(),e(21,"div",49),o(22),m(23,"translate"),t()(),e(24,"td",51)(25,"span",59),_(26,Q,2,3)(27,Z,2,3),t()(),e(28,"td",47)(29,"div",31)(30,"div",60)(31,"span"),o(32),t(),e(33,"span"),o(34),t()(),e(35,"div",61),v(36,"div",62),t()()()()),r&2){let n=a.$implicit,d=T(2);i(3),l(n.device.name),i(2),c("ID: ",n.device.id),i(2),l(n.device.type),i(3),b(n.scheduledCount>0?10:-1),i(),b(n.emergencyCount>0?11:-1),i(),b(n.logsCount===0?12:-1),i(3),c("",n.totalHours,"h"),i(2),c("",n.totalMinutes," min"),i(2),D(n.isOverTarget?"text-red-600":"text-green-600"),i(),c(" ",n.currentPercentage,"% "),i(2),N("",s(23,23,"TARGET"),": ",n.targetPercentage,"%"),i(3),D(d.getStatusClass(n.isOverTarget)),i(),b(n.isOverTarget?26:27),i(6),N("",n.totalHours,"h / ",n.targetHours,"h"),i(2),c("",d.Math.min(d.parseFloat(n.currentPercentage)/d.parseFloat(n.targetPercentage)*100,100).toFixed(0),"%"),i(2),D(d.getProgressBarColor(n.isOverTarget)),A("width",d.Math.min(d.parseFloat(n.currentPercentage)/d.parseFloat(n.targetPercentage)*100,100),"%")}}function te(r,a){if(r&1&&(e(0,"div",7)(1,"div",8)(2,"div",9)(3,"div")(4,"p",10),o(5),m(6,"translate"),t(),e(7,"p",11),o(8),t()(),e(9,"div",12),h(),e(10,"svg",13),v(11,"path",14),t()()(),S(),e(12,"p",15),o(13),t()(),e(14,"div",8)(15,"div",9)(16,"div")(17,"p",10),o(18),m(19,"translate"),t(),e(20,"p",11),o(21),t()(),e(22,"div",16),h(),e(23,"svg",17),v(24,"path",18),t()()(),S(),e(25,"p",15),o(26),m(27,"translate"),t()(),e(28,"div",8)(29,"div",9)(30,"div")(31,"p",10),o(32),m(33,"translate"),t(),e(34,"p",19),o(35),t()(),e(36,"div",20),h(),e(37,"svg",21),v(38,"path",22),t()()(),S(),e(39,"p",15),o(40),t()(),e(41,"div",8)(42,"div",9)(43,"div")(44,"p",10),o(45),m(46,"translate"),t(),e(47,"p",23),o(48),t()(),e(49,"div",24),h(),e(50,"svg",25),v(51,"path",26),t()()(),S(),e(52,"p",15),o(53,"Vy\u017Eaduje pozornos\u0165"),t()()(),e(54,"div",27)(55,"div",28)(56,"h2",29),o(57),m(58,"translate"),t()(),e(59,"div",30)(60,"table",31)(61,"thead",32)(62,"tr",33)(63,"th",34),o(64),m(65,"translate"),t(),e(66,"th",34),o(67),m(68,"translate"),t(),e(69,"th",35),o(70),m(71,"translate"),t(),e(72,"th",36),o(73),m(74,"translate"),t(),e(75,"th",36),o(76,"%"),t(),e(77,"th",35),o(78),m(79,"translate"),t(),e(80,"th",37),o(81),m(82,"translate"),t()()(),e(83,"tbody"),F(84,ee,37,25,"tr",38,K),t()()()(),e(86,"div",39)(87,"div",40)(88,"div",41),h(),e(89,"svg",42),v(90,"path",43),t()(),S(),e(91,"div",44)(92,"h3",45),o(93),m(94,"translate"),t(),e(95,"div",46)(96,"p"),o(97),m(98,"translate"),t()()()()()),r&2){let n=T();i(5),l(s(6,20,"TOTAL_DOWNTIME_HOURS")),i(3),c("",n.totalStats().totalHours,"h"),i(5),l(n.currentMonthLabel()),i(5),l(s(19,22,"AVERAGE_PERCENTAGE")),i(3),c("",n.totalStats().averagePercentage,"%"),i(5),c("",s(27,24,"TARGET"),": 2.5%"),i(6),l(s(33,26,"DEVICES_IN_TARGET")),i(3),l(n.totalStats().devicesInTarget),i(5),c("z ",n.totalStats().totalDevices," strojov"),i(5),l(s(46,28,"DEVICES_OVER_TARGET")),i(3),l(n.totalStats().devicesOverTarget),i(9),l(s(58,30,"DEVICE_DOWNTIME_DETAILS")),i(7),l(s(65,32,"DEVICE")),i(3),l(s(68,34,"DEVICE_TYPE")),i(3),l(s(71,36,"MAINTENANCE_COUNT")),i(3),l(s(74,38,"DOWNTIME")),i(5),l(s(79,40,"STATUS")),i(3),l(s(82,42,"PROGRESS")),i(3),k(n.deviceDowntimeStats()),i(9),l(s(94,44,"DOWNTIME_INFO_TITLE")),i(4),l(s(98,46,"DOWNTIME_INFO_TEXT"))}}function ne(r,a){r&1&&(e(0,"div",6)(1,"div",63),h(),e(2,"svg",64),v(3,"path",14),t(),S(),e(4,"h3",65),o(5,"\u017Diadne zariadenia"),t(),e(6,"p",66),o(7,"Najprv pridajte zariadenia do syst\xE9mu."),t()()())}var C=class C{constructor(){this.dataService=H(R);this.Math=Math;this.parseFloat=parseFloat;this.now=new Date;this.selectedYear=I(this.now.getFullYear());this.selectedMonth=I(this.now.getMonth());this.availableMonths=M(()=>{let a=[],n=new Date;for(let d=0;d<12;d++){let p=new Date(n.getFullYear(),n.getMonth()-d,1);a.push({year:p.getFullYear(),month:p.getMonth(),label:p.toLocaleDateString("sk-SK",{month:"long",year:"numeric"}),value:`${p.getFullYear()}-${p.getMonth()}`})}return a});this.currentMonthLabel=M(()=>new Date(this.selectedYear(),this.selectedMonth(),1).toLocaleDateString("sk-SK",{month:"long",year:"numeric"}));this.devices=P(this.dataService.loadDevices(),{initialValue:[]});this.logs=P(this.dataService.getMaintenanceLogs(),{initialValue:[]});this.deviceDowntimeStats=M(()=>{let a=this.selectedMonth(),n=this.selectedYear(),d=this.devices().filter(p=>p.status==="operational"||p.status==="maintenance");return console.log("\u{1F4CA} Computing downtime stats for devices:",d.length),console.log("\u{1F4CB} Total logs:",this.logs().length),console.log("\u{1F4C5} Selected period:",n,"-",a+1),d.map(p=>{let x=this.logs().filter(g=>{let f=new Date(g.date);return g.deviceId===p.id&&f.getMonth()===a&&f.getFullYear()===n});console.log(`Device ${p.name} (${p.id}):`,x.length,"logs found");let E=x.reduce((g,f)=>(console.log(`  Log ${f.id}: durationMinutes =`,f.durationMinutes),g+(f.durationMinutes||0)),0),u=E/60;console.log(`  Total: ${E} min = ${u.toFixed(1)}h`);let w=160,y=2.5,$=w*y/100,O=u/w*100,z=O>y;return{device:p,totalMinutes:E,totalHours:u.toFixed(1),logsCount:x.length,workingHours:w,currentPercentage:O.toFixed(2),targetPercentage:y.toFixed(1),targetHours:$.toFixed(1),isOverTarget:z,scheduledCount:x.filter(g=>g.type==="scheduled").length,emergencyCount:x.filter(g=>g.type==="emergency").length}})});this.totalStats=M(()=>{let a=this.deviceDowntimeStats(),n=a.reduce((E,u)=>E+parseFloat(u.totalHours),0),d=a.length,p=a.filter(E=>E.isOverTarget).length,x=a.reduce((E,u)=>E+u.logsCount,0);return{totalHours:n.toFixed(1),totalDevices:d,devicesOverTarget:p,devicesInTarget:d-p,totalLogs:x,averagePercentage:d>0?(a.reduce((E,u)=>E+parseFloat(u.currentPercentage),0)/d).toFixed(2):"0.00"}})}onMonthChange(a){let[n,d]=a.split("-").map(Number);this.selectedYear.set(n),this.selectedMonth.set(d)}getStatusClass(a){return a?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}getProgressBarColor(a){return a?"bg-red-500":"bg-green-500"}};C.\u0275fac=function(n){return new(n||C)},C.\u0275cmp=L({type:C,selectors:[["app-downtime"]],decls:13,vars:8,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-semibold","text-gray-800"],[1,"flex","items-center","gap-3"],["for","monthSelect",1,"text-sm","font-medium","text-gray-700"],["id","monthSelect",1,"px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","bg-white",3,"change","value"],[3,"value"],[1,"flex","items-center","justify-center","h-64"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6","mb-8"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-2xl","font-bold","text-gray-800"],[1,"bg-blue-100","p-3","rounded-full"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-xs","text-gray-500","mt-2"],[1,"bg-purple-100","p-3","rounded-full"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-purple-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"text-2xl","font-bold","text-green-600"],[1,"bg-green-100","p-3","rounded-full"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-2xl","font-bold","text-red-600"],[1,"bg-red-100","p-3","rounded-full"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"text-xl","font-semibold","text-gray-800"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-gray-50"],[1,"text-xs","text-gray-500","uppercase"],[1,"py-3","px-4","text-left"],[1,"py-3","px-4","text-center"],[1,"py-3","px-4","text-right"],[1,"py-3","px-4"],[1,"border-b","hover:bg-gray-50"],[1,"mt-6","bg-blue-50","border","border-blue-200","rounded-lg","p-4"],[1,"flex"],[1,"flex-shrink-0"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"ml-3"],[1,"text-sm","font-medium","text-blue-800"],[1,"mt-2","text-sm","text-blue-700"],[1,"py-4","px-4"],[1,"font-medium","text-gray-800"],[1,"text-xs","text-gray-500"],[1,"py-4","px-4","text-sm","text-gray-600"],[1,"py-4","px-4","text-center"],[1,"flex","items-center","justify-center","gap-2"],[1,"px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded"],[1,"px-2","py-1","text-xs","bg-red-100","text-red-800","rounded"],[1,"text-xs","text-gray-400"],[1,"py-4","px-4","text-right"],[1,"font-semibold","text-gray-800"],[1,"font-semibold"],[1,"px-3","py-1","text-xs","font-semibold","rounded-full"],[1,"flex","justify-between","text-xs","text-gray-600","mb-1"],[1,"w-full","bg-gray-200","rounded-full","h-2"],[1,"h-2","rounded-full","transition-all","duration-300"],[1,"text-center"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-12","w-12","text-gray-400"],[1,"mt-2","text-sm","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"]],template:function(n,d){n&1&&(e(0,"div",0)(1,"h1",1),o(2),m(3,"translate"),t(),e(4,"div",2)(5,"label",3),o(6),m(7,"translate"),t(),e(8,"select",4),V("change",function(x){return d.onMonthChange(x.target.value)}),F(9,U,2,2,"option",5,W),t()()(),_(11,te,99,48)(12,ne,8,0,"div",6)),n&2&&(i(2),c("\u23F1\uFE0F ",s(3,4,"DOWNTIME_TRACKING")),i(4),c("",s(7,6,"MONTH"),":"),i(2),B("value",d.selectedYear()+"-"+d.selectedMonth()),i(),k(d.availableMonths()),i(2),b(d.devices().length>0?11:12))},dependencies:[G,j],encapsulation:2,changeDetection:0});var Y=C;export{Y as DowntimeComponent};
