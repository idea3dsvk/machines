import{a as ie}from"./chunk-4T5S54VI.js";import{a as ee}from"./chunk-BIV3WBZH.js";import{a as ae}from"./chunk-HP2LCRUS.js";import{a as ne}from"./chunk-4KKHH7M7.js";import{a as te}from"./chunk-PYO53IYO.js";import{$ as y,A as w,Aa as H,B as n,F as R,G as z,Ga as B,Ka as W,La as X,Na as Z,O as x,Oa as J,P as g,R as F,S as j,T as q,U as A,V as a,W as t,X as f,Y,Z as Q,_ as G,aa as K,ba as b,da as m,ea as I,f as U,ha as L,ia as o,ja as v,ka as s,la as O,q as D,r as C,s as E,t as P,u as $,va as c,wa as p,za as k}from"./chunk-JK5TQ35Y.js";import"./chunk-K5CSBBV3.js";var h=class h{constructor(i){this.sanitizer=i;this.data=H.required();this.qrCodeUrl=k(()=>{let e=`https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(this.data())}`;return console.log("\u{1F4CA} Generated QR code URL:",e),this.sanitizer.bypassSecurityTrustUrl(e)});console.log("\u{1F532} QR Code component initialized")}};h.\u0275fac=function(e){return new(e||h)(R(W))},h.\u0275cmp=z({type:h,selectors:[["app-qr-code"]],inputs:{data:[1,"data"]},decls:2,vars:1,consts:[[1,"p-2","bg-white","inline-block","rounded-lg","shadow-inner"],["alt","QR Code",1,"w-40","h-40",2,"image-rendering","pixelated",3,"src"]],template:function(e,r){e&1&&(Y(0,"div",0),G(1,"img",1),Q()),e&2&&(n(),K("src",r.qrCodeUrl(),w))},dependencies:[B],encapsulation:2,changeDetection:0});var V=h;function pe(l,i){if(l&1&&(a(0,"div",19)(1,"h2",20),o(2,"Fotka zariadenia"),t(),f(3,"img",45),t()),l&2){let e=m();n(3),A("src",e.imageUrl,w)("alt",e.name)}}function se(l,i){if(l&1&&(a(0,"div")(1,"strong",22),o(2,"V\xFDrobca:"),t(),o(3),t()),l&2){let e=m();n(3),s(" ",e.manufacturer)}}function me(l,i){if(l&1&&(a(0,"div",48)(1,"strong",22),o(2),t(),a(3,"span",49),o(4),t()()),l&2){let e=i.$implicit,r=m(2);n(2),s("",e,":"),n(2),v(r.specifications[e])}}function ue(l,i){if(l&1&&(a(0,"div",19)(1,"h2",20),o(2),c(3,"translate"),t(),a(4,"div",46)(5,"div",47),j(6,me,5,2,"div",48,F),t()()()),l&2){let e=m(),r=m();n(2),s("\u{1F4CB} ",p(3,1,"SPECIFICATIONS")),n(4),q(r.objectKeys(e.specifications))}}function ve(l,i){l&1&&(a(0,"span",51),o(1,"\u26A0\uFE0F"),t())}function xe(l,i){l&1&&(a(0,"span",51),o(1,"\u23F0"),t())}function ge(l,i){if(l&1&&(a(0,"div",23)(1,"div",50)(2,"div")(3,"strong",22),o(4),c(5,"translate"),t(),a(6,"p",49),o(7),t()(),a(8,"div")(9,"strong",22),o(10),c(11,"translate"),t(),a(12,"p",49),o(13),c(14,"translate"),c(15,"translate"),t()(),a(16,"div")(17,"strong",22),o(18),c(19,"translate"),t(),a(20,"p",49),o(21),x(22,ve,2,0,"span",51)(23,xe,2,0,"span",51),t()()()()),l&2){let e=m(),r=m();n(4),s("",p(5,10,"INSPECTION_DATE"),":"),n(3),v(e.electricalInspectionDate),n(3),s("",p(11,12,"VALIDITY"),":"),n(3),O("",e.electricalInspectionPeriod," ",e.electricalInspectionPeriod===1?p(14,14,"YEAR"):p(15,16,"YEARS")),n(5),s("",p(19,18,"EXPIRATION"),":"),n(2),L(r.getInspectionExpiryClass(e.electricalInspectionExpiry)),n(),s(" ",e.electricalInspectionExpiry," "),n(),g(r.isInspectionExpired(e.electricalInspectionExpiry)?22:r.isInspectionExpiringSoon(e.electricalInspectionExpiry)?23:-1)}}function _e(l,i){if(l&1){let e=y();a(0,"div",24)(1,"div")(2,"label",25),o(3),c(4,"translate"),t(),f(5,"input",52,4),t(),a(7,"div")(8,"label",25),o(9),c(10,"translate"),t(),a(11,"select",53,5)(13,"option",54),o(14),c(15,"translate"),t(),a(16,"option",55),o(17),c(18,"translate"),t(),a(19,"option",56),o(20),c(21,"translate"),t(),a(22,"option",57),o(23),c(24,"translate"),t(),a(25,"option",58),o(26),c(27,"translate"),t(),a(28,"option",59),o(29),c(30,"translate"),t()()(),a(31,"button",60),b("click",function(){C(e);let d=I(6),u=I(12),_=m(2);return E(_.updateElectricalInspection(d.value,+u.value))}),o(32),c(33,"translate"),t()()}l&2&&(n(3),s("",p(4,9,"INSPECTION_DATE")," *"),n(6),s("",p(10,11,"VALIDITY")," *"),n(5),s("1 ",p(15,13,"YEAR")),n(3),s("2 ",p(18,15,"YEARS")),n(3),s("3 ",p(21,17,"YEARS")),n(3),s("4 ",p(24,19,"YEARS")),n(3),s("5 ",p(27,21,"YEARS")),n(3),s("10 ",p(30,23,"YEARS")),n(3),s(" \u{1F4BE} ",p(33,25,"SAVE_INSPECTION")," "))}function fe(l,i){if(l&1&&f(0,"app-qr-code",38),l&2){let e=m(2);A("data",e.qrCodeData())}}function Ce(l,i){if(l&1){let e=y();a(0,"button",61),b("click",function(){C(e);let d=m(2);return E(d.updateStatus("maintenance"))}),o(1),c(2,"translate"),t(),a(3,"button",62),b("click",function(){C(e);let d=m(2);return E(d.updateStatus("offline"))}),o(4),c(5,"translate"),t()}l&2&&(n(),v(p(2,2,"SET_STATUS_MAINTENANCE")),n(3),v(p(5,4,"SET_STATUS_OFFLINE")))}function Ee(l,i){if(l&1){let e=y();a(0,"button",63),b("click",function(){C(e);let d=m(2);return E(d.updateStatus("operational"))}),o(1),c(2,"translate"),t()}l&2&&(n(),v(p(2,1,"SET_STATUS_OPERATIONAL")))}function be(l,i){if(l&1&&(a(0,"a",43),o(1),c(2,"translate"),t()),l&2){let e=m();A("href",e.manualUrl,w),n(),s(" \u{1F4C4} ",p(2,2,"VIEW_MANUAL")," ")}}function Se(l,i){l&1&&(a(0,"div",44),o(1," Manu\xE1l nie je k dispoz\xEDcii "),t())}function De(l,i){if(l&1){let e=y();a(0,"div",64)(1,"label",65)(2,"span",66),o(3,"Nahra\u0165 manu\xE1l (PDF)"),t(),a(4,"input",67,6),b("change",function(d){C(e);let u=m(2);return E(u.uploadManual(d))}),t()()(),a(6,"button",68),b("click",function(){C(e);let d=m(2);return E(d.decommissionDevice())}),o(7),c(8,"translate"),t()}l&2&&(n(7),v(p(8,1,"DECOMMISSION_DEVICE")))}function ye(l,i){if(l&1){let e=y();a(0,"div",8)(1,"a",9),P(),a(2,"svg",10),f(3,"path",11),t(),o(4),c(5,"translate"),t()(),$(),a(6,"div",12)(7,"div",13)(8,"div",14)(9,"div",15)(10,"div")(11,"h1",16),o(12),t(),a(13,"p",17),o(14),t()(),a(15,"span",18),o(16),c(17,"translate"),t()(),x(18,pe,4,2,"div",19),a(19,"div",19)(20,"h2",20),o(21),c(22,"translate"),t(),a(23,"div",21)(24,"div")(25,"strong",22),o(26),c(27,"translate"),t(),o(28),t(),x(29,se,4,1,"div"),a(30,"div")(31,"strong",22),o(32),c(33,"translate"),t(),o(34),t(),a(35,"div")(36,"strong",22),o(37),c(38,"translate"),t(),o(39),t(),a(40,"div")(41,"strong",22),o(42),c(43,"translate"),t(),o(44),t(),a(45,"div")(46,"strong",22),o(47),c(48,"translate"),t(),o(49),t()()(),x(50,ue,8,3,"div",19),a(51,"div",19)(52,"h2",20),o(53),c(54,"translate"),t(),x(55,ge,24,20,"div",23),x(56,_e,34,27,"div",24),t(),a(57,"div",19)(58,"h2",20),o(59),c(60,"translate"),t(),a(61,"div",24)(62,"div")(63,"label",25),o(64,"Typ \xFAdr\u017Eby"),t(),a(65,"div",26)(66,"label",27),f(67,"input",28,0),a(69,"span",29),o(70,"\u{1F4C5} Pl\xE1novan\xE1 \xFAdr\u017Eba"),t()(),a(71,"label",27),f(72,"input",30,1),a(74,"span",29),o(75,"\u{1F6A8} Neodkladn\xE1 \xFAdr\u017Eba"),t()()()(),a(76,"div")(77,"label",25),o(78,"Trvanie \xFAdr\u017Eby (min\xFAty) *"),t(),f(79,"input",31,2),a(81,"p",32),o(82,"Minim\xE1lne trvanie: 15 min\xFAt"),t()(),f(83,"textarea",33,3),c(85,"translate"),a(86,"button",34),b("click",function(){C(e);let d=I(68),u=I(80),_=I(84);return m().logMaintenance(_.value,d.checked?"scheduled":"emergency",+u.value),_.value="",u.value="30",E(d.checked=!0)}),o(87),c(88,"translate"),t()()()()(),a(89,"div",35)(90,"div",36)(91,"h2",20),o(92),c(93,"translate"),t(),a(94,"div",37),x(95,fe,1,1,"app-qr-code",38),t(),a(96,"p",39),o(97),c(98,"translate"),t(),a(99,"div",40)(100,"h3",41),o(101),c(102,"translate"),t(),x(103,Ce,6,6)(104,Ee,3,3,"button",42),x(105,be,3,4,"a",43)(106,Se,2,0,"div",44),x(107,De,9,3),t()()()()}if(l&2){let e,r=i,d=m();n(4),s(" ",p(5,34,"BACK_TO_DEVICES")," "),n(8),v(r.name),n(2),O("",r.type," - ",r.location),n(),L(d.getStatusClass(r.status)),n(),s(" ",p(17,36,"STATUS_"+r.status.toUpperCase())," "),n(2),g(r.imageUrl?18:-1),n(3),v(p(22,38,"DEVICE_DETAILS")),n(5),s("",p(27,40,"DEVICE_ID"),":"),n(2),s(" ",r.id),n(),g(r.manufacturer?29:-1),n(3),s("",p(33,42,"LOCATION"),":"),n(2),s(" ",r.location),n(3),s("",p(38,44,"LAST_MAINTENANCE"),":"),n(2),s(" ",r.lastMaintenance),n(3),s("",p(43,46,"NEXT_MAINTENANCE"),":"),n(2),s(" ",r.nextMaintenance),n(3),s("",p(48,48,"DOWNTIME"),":"),n(2),s(" ",r.downtime,"h"),n(),g(r.specifications&&d.objectKeys(r.specifications).length>0?50:-1),n(3),s("\u26A1 ",p(54,50,"ELECTRICAL_INSPECTION")),n(2),g(r.electricalInspectionDate&&r.electricalInspectionExpiry?55:-1),n(),g(((e=d.authService.currentUser())==null?null:e.role)==="admin"?56:-1),n(3),v(p(60,52,"LOG_MAINTENANCE")),n(24),A("placeholder",p(85,54,"MAINTENANCE_NOTES_PLACEHOLDER")),n(4),v(p(88,56,"COMPLETE_LOG_MAINTENANCE")),n(5),v(p(93,58,"DEVICE_QR_CODE")),n(3),g(d.qrCodeData()?95:-1),n(2),v(p(98,60,"SCAN_QR_CODE_INFO")),n(4),v(p(102,62,"ACTIONS")),n(2),g(r.status==="operational"?103:104),n(2),g(r.manualUrl&&!r.manualUrl.includes("example.com")?105:106),n(2),g(d.authService.isAdmin()?107:-1)}}function Ie(l,i){l&1&&(a(0,"div",7)(1,"p",17),o(2),c(3,"translate"),t()()),l&2&&(n(2),v(p(3,1,"LOADING_DEVICE_DETAILS")))}var T=class T{constructor(){this.route=D(X);this.router=D(Z);this.dataService=D(ne);this.authService=D(ee);this.sanitizer=D(ae);this.allDevices=this.dataService.getDevicesSignal();this.deviceId=ie(this.route.paramMap.pipe(U(i=>i.get("id"))));this.device=k(()=>{let i=this.deviceId();if(i)return this.allDevices().find(e=>e.id===i)});this.qrCodeData=k(()=>{let i=this.device();return i?`Device ID: ${i.id}
Name: ${i.name}
Location: ${i.location}`:""})}getStatusClass(i){switch(i){case"operational":return"bg-green-100 text-green-800";case"maintenance":return"bg-yellow-100 text-yellow-800";case"offline":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}logMaintenance(i,e,r){let d=this.device(),u=this.authService.currentUser();if(!(!d||!u))try{let _=this.sanitizer.sanitizeNotes(i),N=this.sanitizer.sanitizeMaintenanceType(e),S=this.sanitizer.sanitizeInteger(r);if(!_||_.trim()===""){alert("Pros\xEDm zadajte pozn\xE1mky k \xFAdr\u017Ebe.");return}if(!S||S<15){alert("Minim\xE1lne trvanie \xFAdr\u017Eby je 15 min\xFAt.");return}let re=N==="scheduled"?"\u{1F4C5} Pl\xE1novan\xE1":"\u{1F6A8} Neodkladn\xE1",le=(S/60).toFixed(1);console.log(`\u{1F4DD} Logging ${N} maintenance for device:`,d.name,"Duration:",S,"minutes"),this.dataService.addMaintenanceLog({deviceId:d.id,deviceName:d.name,date:new Date().toISOString().split("T")[0],technician:u.email,notes:_,type:N,durationMinutes:S}).subscribe({next:M=>{console.log("\u2705 Maintenance log saved:",M),alert(`\xDAdr\u017Eba zariadenia "${d.name}" bola \xFAspe\u0161ne zaznamenan\xE1.

Typ: ${re}
Technik: ${u.email}
D\xE1tum: ${new Date().toLocaleDateString("sk-SK")}
Trvanie: ${S} min\xFAt (${le}h)

Pozn\xE1mky: ${_}`)},error:M=>{console.error("\u274C Error logging maintenance:",M),alert(`Chyba pri zaznamen\xE1van\xED \xFAdr\u017Eby: ${M.message}`)}})}catch(_){alert(`Chyba valid\xE1cie: ${_.message}`)}}updateStatus(i){let e=this.device();e&&(console.log("\u{1F504} Updating device status to:",i),this.dataService.updateDeviceStatus(e.id,i).subscribe({next:r=>console.log("\u2705 Device status updated:",r),error:r=>console.error("\u274C Error updating status:",r)}))}decommissionDevice(){let i=this.device();if(!i)return;let e=`Naozaj chcete vyradi\u0165 zariadenie "${i.name}"? T\xE1to akcia sa ned\xE1 vr\xE1ti\u0165 sp\xE4\u0165.`;confirm(e)&&(console.log("\u{1F5D1}\uFE0F Decommissioning device:",i.id),this.dataService.deleteDevice(i.id).subscribe({next:()=>{console.log("\u2705 Device successfully decommissioned"),alert(`Zariadenie "${i.name}" bolo \xFAspe\u0161ne vyraden\xE9.`),this.router.navigate(["/devices"])},error:r=>{console.error("\u274C Error decommissioning device:",r),alert(`Chyba pri vyra\u010Fovan\xED zariadenia: ${r.message}`)}}))}uploadManual(i){let e=i.target,r=this.device();if(!e.files||e.files.length===0||!r)return;let d=e.files[0];if(d.type!=="application/pdf"){alert("M\xF4\u017Eete nahra\u0165 len PDF s\xFAbory."),e.value="";return}if(d.size>10*1024*1024){alert("S\xFAbor je pr\xEDli\u0161 ve\u013Ek\xFD. Maxim\xE1lna ve\u013Ekos\u0165 je 10MB."),e.value="";return}console.log("\u{1F4E4} Uploading manual:",d.name),this.dataService.uploadDeviceManual(r.id,d).subscribe({next:u=>{console.log("\u2705 Manual uploaded successfully:",u),alert(`Manu\xE1l "${d.name}" bol \xFAspe\u0161nenahran\xFD.`),e.value=""},error:u=>{console.error("\u274C Error uploading manual:",u),alert(`Chyba pri nahr\xE1van\xED manu\xE1lu: ${u.message}`),e.value=""}})}updateElectricalInspection(i,e){let r=this.device();if(r){if(!i||i.trim()===""){alert("Pros\xEDm zadajte d\xE1tum rev\xEDzie.");return}if(![1,2,3,4,5,10].includes(e)){alert("Pros\xEDm vyberte platn\xFA peri\xF3du.");return}console.log("\u26A1 Updating electrical inspection:",i,e),this.dataService.updateElectricalInspection(r.id,i,e).subscribe({next:d=>{console.log("\u2705 Electrical inspection updated:",d),alert(`Elektrick\xE1 rev\xEDzia zariadenia "${r.name}" bola \xFAspe\u0161ne aktualizovan\xE1.

D\xE1tum: ${i}
Platnos\u0165: ${e} ${e===1?"rok":e<5?"roky":"rokov"}
Expir\xE1cia: ${d.electricalInspectionExpiry}`)},error:d=>{console.error("\u274C Error updating electrical inspection:",d),alert(`Chyba pri aktualiz\xE1cii rev\xEDzie: ${d.message}`)}})}}isInspectionExpired(i){return i?new Date(i)<new Date:!1}isInspectionExpiringSoon(i){if(!i)return!1;let e=new Date(i),r=new Date,d=Math.floor((e.getTime()-r.getTime())/(1e3*60*60*24));return d>0&&d<=30}getInspectionExpiryClass(i){return this.isInspectionExpired(i)?"text-red-600 font-bold":this.isInspectionExpiringSoon(i)?"text-yellow-600 font-bold":"text-green-600"}objectKeys(i){return Object.keys(i)}};T.\u0275fac=function(e){return new(e||T)},T.\u0275cmp=z({type:T,selectors:[["app-device-detail"]],decls:2,vars:1,consts:[["typeScheduled",""],["typeEmergency",""],["duration",""],["notes",""],["inspectionDate",""],["inspectionPeriod",""],["fileInput",""],[1,"text-center","py-10"],[1,"mb-4"],["routerLink","/devices",1,"text-blue-600","hover:underline","flex","items-center"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"flex","justify-between","items-start"],[1,"text-3xl","font-bold","text-gray-800"],[1,"text-gray-500"],[1,"px-3","py-1","text-sm","font-semibold","rounded-full","capitalize"],[1,"mt-6","border-t","pt-6"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm"],[1,"text-gray-600"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-4"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","gap-4"],[1,"flex","items-center","cursor-pointer"],["type","radio","name","maintenanceType","value","scheduled","checked","",1,"mr-2"],[1,"text-sm"],["type","radio","name","maintenanceType","value","emergency",1,"mr-2"],["type","number","min","15","step","5","value","30","required","","placeholder","Minim\xE1lne 15 min\xFAt",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"text-xs","text-gray-500","mt-1"],["rows","4",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"placeholder"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"click"],[1,"lg:col-span-1"],[1,"bg-white","p-6","rounded-lg","shadow-md","text-center"],[1,"flex","justify-center"],[3,"data"],[1,"mt-4","text-xs","text-gray-500"],[1,"mt-6","border-t","pt-6","space-y-3"],[1,"text-lg","font-semibold","text-gray-700"],[1,"w-full","px-4","py-2","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors"],["target","_blank",1,"block","w-full","text-center","px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"href"],[1,"text-center","text-gray-400","text-sm","py-2"],[1,"max-w-full","h-auto","rounded-lg","shadow-md","max-h-96","object-cover",3,"src","alt"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-4"],[1,"space-y-3","text-sm"],[1,"flex","justify-between","border-b","border-gray-200","pb-2"],[1,"text-gray-800"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","text-sm"],[1,"ml-1"],["type","date",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["value","10"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-yellow-500","text-white","rounded-md","hover:bg-yellow-600","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-gray-500","text-white","rounded-md","hover:bg-gray-600","transition-colors",3,"click"],[1,"w-full","px-4","py-2","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors",3,"click"],[1,"border-t","pt-3"],[1,"block","w-full"],[1,"text-xs","text-gray-600","mb-1","block"],["type","file","accept","application/pdf",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded","file:border-0","file:text-sm","file:font-semibold","file:bg-blue-50","file:text-blue-700","hover:file:bg-blue-100","cursor-pointer",3,"change"],[1,"w-full","px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","transition-colors",3,"click"]],template:function(e,r){if(e&1&&x(0,ye,108,64)(1,Ie,4,3,"div",7),e&2){let d;g((d=r.device())?0:1,d)}},dependencies:[B,J,V,te],encapsulation:2,changeDetection:0});var oe=T;export{oe as DeviceDetailComponent};
