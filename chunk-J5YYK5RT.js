import{a as Q}from"./chunk-NUK3SMTP.js";import"./chunk-X3AAU7TY.js";import{a as j}from"./chunk-2OOC5WRJ.js";import{a as $}from"./chunk-U7QLRQFP.js";import{$a as i,Ab as u,Bb as z,Eb as w,La as L,P as T,Qb as B,Rb as H,Sb as M,Ta as x,U as v,Ua as g,V as y,Xa as k,Ya as D,Za as N,_a as r,ab as E,ba as P,eb as S,gb as _,ib as c,pb as q,qb as l,rb as p,sb as C,tb as I,yb as V,za as d,zb as m}from"./chunk-2YHSOBKZ.js";import{a as A,b as F}from"./chunk-K5CSBBV3.js";var W=(o,t,e)=>({"bg-green-100 text-green-800":o,"bg-red-100 text-red-800":t,"bg-blue-100 text-blue-800":e}),R=(o,t)=>t.id;function U(o,t){if(o&1){let e=S();r(0,"button",10),_("click",function(){v(e);let n=c();return y(n.toggleAddForm())}),l(1),m(2,"translate"),i()}if(o&2){let e=c();d(),C(" ",e.showAddForm()?"CANCEL":u(2,1,"ADD_NEW_PART")," ")}}function Z(o,t){if(o&1&&(r(0,"option",22),l(1),i()),o&2){let e=t.$implicit;N("value",e.id),d(),I("",e.name," (",e.type,")")}}function K(o,t){if(o&1){let e=S();r(0,"div",3)(1,"h2",11),l(2),m(3,"translate"),i(),r(4,"form",12),_("submit",function(n){v(e);let s=c();return y(s.addPart(n))}),r(5,"div",13)(6,"div")(7,"label",14),l(8),m(9,"translate"),i(),E(10,"input",15),i(),r(11,"div")(12,"label",14),l(13),m(14,"translate"),i(),E(15,"input",16),i(),r(16,"div")(17,"label",14),l(18),m(19,"translate"),i(),E(20,"input",17),i(),r(21,"div")(22,"label",14),l(23),m(24,"translate"),i(),E(25,"input",18),i(),r(26,"div",19)(27,"label",14),l(28,"Zariadenie (nepovinn\xE9)"),i(),r(29,"select",20)(30,"option",21),l(31,"-- V\u0161eobecn\xFD diel (nie je priraden\xFD k zariadeniu) --"),i(),k(32,Z,2,3,"option",22,R),i(),r(34,"p",23),l(35,"Vyberte zariadenie ak diel patr\xED k \u0161pecifick\xE9mu zariadeniu"),i()()(),r(36,"div",24)(37,"button",25),_("click",function(){v(e);let n=c();return y(n.toggleAddForm())}),l(38," Cancel "),i(),r(39,"button",26),l(40," Add Part "),i()()()()}if(o&2){let e=c();d(2),p(u(3,5,"ADD_NEW_PART")),d(6),p(u(9,7,"PART_NAME")),d(5),p(u(14,9,"SKU")),d(5),p(u(19,11,"QUANTITY")),d(5),p(u(24,13,"LOCATION")),d(9),D(e.devices())}}function Y(o,t){if(o&1&&(r(0,"span",35),l(1),i()),o&2){let e=c().$implicit;d(),p(e.deviceName)}}function G(o,t){o&1&&(r(0,"span",36),l(1,"V\u0161eobecn\xFD"),i())}function J(o,t){if(o&1&&(r(0,"div",45),l(1),i()),o&2){let e=c(2).$implicit;d(),C(' "',e.lastChange.notes,'" ')}}function X(o,t){if(o&1&&(r(0,"div",38)(1,"div",43),l(2),m(3,"date"),i(),r(4,"div",44),l(5),i(),x(6,J,2,1,"div",45),r(7,"div",46),l(8),i()()),o&2){let e=c().$implicit;d(2),C(" ",z(3,6,e.lastChange.date,"dd.MM.yyyy HH:mm")," "),d(3),C(" ",e.lastChange.changedBy," "),d(),g(e.lastChange.notes?6:-1),d(),N("ngClass",V(9,W,e.lastChange.changeType==="increase",e.lastChange.changeType==="decrease",e.lastChange.changeType==="set")),d(),I(" ",e.lastChange.quantityBefore," \u2192 ",e.lastChange.quantityAfter," ")}}function ee(o,t){o&1&&(r(0,"span",39),l(1,"Bez zmien"),i())}function te(o,t){if(o&1){let e=S();r(0,"button",47),_("click",function(){v(e);let n=c().$implicit,s=c(2);return y(s.setQuantity(n.id,n.quantity))}),l(1," \u270E "),i(),r(2,"button",48),_("click",function(){v(e);let n=c().$implicit,s=c(2);return y(s.deletePart(n.id,n.name))}),l(3," \u{1F5D1}\uFE0F "),i()}}function ie(o,t){if(o&1){let e=S();r(0,"tr",32)(1,"td",33),l(2),i(),r(3,"td",34),l(4),i(),r(5,"td",34),x(6,Y,2,1,"span",35)(7,G,2,0,"span",36),i(),r(8,"td",34),l(9),i(),r(10,"td",29),l(11),i(),r(12,"td",37),x(13,X,9,13,"div",38)(14,ee,2,0,"span",39),i(),r(15,"td",28)(16,"div",40)(17,"button",41),_("click",function(){let n=v(e).$implicit,s=c(2);return y(s.decreaseQuantity(n.id,n.quantity))}),l(18," \u2212 "),i(),x(19,te,4,0),r(20,"button",42),_("click",function(){let n=v(e).$implicit,s=c(2);return y(s.increaseQuantity(n.id,n.quantity))}),l(21," + "),i()()()()}if(o&2){let e=t.$implicit,a=c(2);d(2),p(e.name),d(2),p(e.sku),d(2),g(e.deviceName?6:7),d(3),p(e.location),d(),q(a.getQuantityClass(e.quantity)),d(),C(" ",e.quantity," "),d(2),g(e.lastChange?13:14),d(6),g(a.authService.isAdmin()?19:-1)}}function ne(o,t){if(o&1&&(r(0,"table",8)(1,"thead")(2,"tr",27)(3,"th",28),l(4),m(5,"translate"),i(),r(6,"th",28),l(7),m(8,"translate"),i(),r(9,"th",28),l(10,"Zariadenie"),i(),r(11,"th",28),l(12),m(13,"translate"),i(),r(14,"th",29),l(15),m(16,"translate"),i(),r(17,"th",28),l(18,"Posledn\xE1 zmena"),i(),r(19,"th",30),l(20,"Actions"),i()()(),r(21,"tbody",31),k(22,ie,22,9,"tr",32,R),i()()),o&2){let e=c();d(4),p(u(5,4,"PART_NAME")),d(3),p(u(8,6,"SKU")),d(5),p(u(13,8,"LOCATION")),d(3),p(u(16,10,"QUANTITY")),d(7),D(e.filteredParts())}}function ae(o,t){o&1&&(r(0,"div",9)(1,"p",44),l(2),m(3,"translate"),i()()),o&2&&(d(2),p(u(3,1,"LOADING_PARTS")))}function re(o,t){o&1&&(r(0,"div",9)(1,"p",44),l(2),m(3,"translate"),i()()),o&2&&(d(2),p(u(3,1,"NO_PARTS_FOUND")))}var h=class h{constructor(){this.dataService=T(j);this.authService=T(Q);this.parts=w(()=>this.dataService.getPartsSignal()());this.devices=w(()=>this.dataService.getDevicesSignal()());this.searchTerm=P("");this.showAddForm=P(!1);this.partsWithHistory=P([]);this.filteredParts=w(()=>{let t=this.searchTerm().toLowerCase(),e=this.partsWithHistory().length>0?this.partsWithHistory():this.parts();return t?e.filter(a=>a.name.toLowerCase().includes(t)||a.sku.toLowerCase().includes(t)||a.location.toLowerCase().includes(t)||a.deviceName&&a.deviceName.toLowerCase().includes(t)):e});this.dataService.getParts().subscribe(()=>{this.loadPartsHistory()}),this.dataService.loadDevices().subscribe()}loadPartsHistory(){let t=this.parts(),e=[];t.forEach(a=>{this.dataService.getPartLastChange(a.id).subscribe(n=>{e.push(F(A({},a),{lastChange:n?{date:n.created_at,changedBy:n.changed_by,notes:n.notes,changeType:n.change_type,quantityBefore:n.quantity_before,quantityAfter:n.quantity_after}:void 0})),e.length===t.length&&this.partsWithHistory.set(e)})})}onSearch(t){let e=t.target;this.searchTerm.set(e.value)}getQuantityClass(t){return t<10?"text-red-600 font-bold":t<25?"text-yellow-600":"text-gray-800"}toggleAddForm(){this.showAddForm.update(t=>!t)}increaseQuantity(t,e){let a=prompt("D\xF4vod zv\xFD\u0161enia mno\u017Estva (POVINN\xC9 - napr. n\xE1kup, dod\xE1vka):");if(!a||a.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zv\xFD\u0161en\xED mno\u017Estva");return}console.log("\u2795 Increasing quantity for part:",t),this.dataService.updatePartQuantity(t,e+1,a,"increase").subscribe({next:n=>{console.log("\u2705 Quantity increased:",n),setTimeout(()=>this.loadPartsHistory(),500)},error:n=>{console.error("\u274C Error increasing quantity:",n),alert("Error updating quantity: "+n.message)}})}decreaseQuantity(t,e){if(e<=0){alert("Mno\u017Estvo nem\xF4\u017Ee by\u0165 z\xE1porn\xE9");return}let a=prompt("D\xF4vod zn\xED\u017Eenia mno\u017Estva (POVINN\xC9 - napr. pou\u017Eit\xE9 pri oprave CNC Fr\xE9za):");if(!a||a.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zn\xED\u017Een\xED mno\u017Estva");return}console.log("\u2796 Decreasing quantity for part:",t),this.dataService.updatePartQuantity(t,e-1,a,"decrease").subscribe({next:n=>{console.log("\u2705 Quantity decreased:",n),setTimeout(()=>this.loadPartsHistory(),500)},error:n=>{console.error("\u274C Error decreasing quantity:",n),alert("Error updating quantity: "+n.message)}})}setQuantity(t,e){let a=prompt("Zadajte nov\xE9 mno\u017Estvo:");if(a===null)return;let n=parseInt(a);if(isNaN(n)||n<0){alert("Zadajte platn\xE9 kladn\xE9 \u010D\xEDslo");return}let s=prompt("D\xF4vod zmeny mno\u017Estva (POVINN\xC9 - napr. invent\xFAra, korekcia):");if(!s||s.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zmene mno\u017Estva");return}console.log("\u270F\uFE0F Setting quantity for part:",t,"to",n),this.dataService.updatePartQuantity(t,n,s,"set").subscribe({next:b=>{console.log("\u2705 Quantity set:",b),setTimeout(()=>this.loadPartsHistory(),500)},error:b=>{console.error("\u274C Error setting quantity:",b),alert("Error updating quantity: "+b.message)}})}addPart(t){t.preventDefault();let e=t.target,a=new FormData(e),n=a.get("deviceId"),s=n?this.devices().find(f=>f.id===n):void 0,b={name:a.get("name"),sku:a.get("sku"),quantity:parseInt(a.get("quantity")),location:a.get("location"),deviceId:n||void 0,deviceName:s?.name||void 0};console.log("\u{1F504} Adding new part:",b),this.dataService.addPart(b).subscribe({next:f=>{console.log("\u2705 Part added successfully:",f),this.showAddForm.set(!1),e.reset(),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after adding new part"),this.loadPartsHistory()})},error:f=>{console.error("\u274C Error adding part:",f),alert("Error adding part: "+f.message)}})}deletePart(t,e){let a=`Naozaj chcete vymaza\u0165 n\xE1hradn\xFD diel "${e}"?

T\xE1to akcia sa ned\xE1 vr\xE1ti\u0165 sp\xE4\u0165 a vyma\u017Ee aj v\u0161etku hist\xF3riu zmien tohto dielu.`;confirm(a)&&(console.log("\u{1F5D1}\uFE0F Deleting part:",t),this.dataService.deletePart(t).subscribe({next:()=>{console.log("\u2705 Part deleted successfully"),alert(`N\xE1hradn\xFD diel "${e}" bol \xFAspe\u0161ne vymazan\xFD.`),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after deletion"),this.loadPartsHistory()})},error:n=>{console.error("\u274C Error deleting part:",n),alert(`Chyba pri vymaz\xE1van\xED dielu: ${n.message}`)}}))}};h.\u0275fac=function(e){return new(e||h)},h.\u0275cmp=L({type:h,selectors:[["app-part-list"]],decls:13,vars:7,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-semibold","text-gray-800"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors"],[1,"bg-white","p-6","rounded-lg","shadow-md","mb-6"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"mb-4"],["type","text","placeholder","H\u013Eada\u0165 diely (n\xE1zov, SKU, umiestnenie, zariadenie)...",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input"],[1,"overflow-x-auto"],[1,"w-full","text-left"],[1,"text-center","py-10"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"click"],[1,"text-xl","font-semibold","mb-4"],[3,"submit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","name","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","sku","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","number","name","quantity","required","","min","0",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","location","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],[1,"md:col-span-2"],["name","deviceId",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["value",""],[3,"value"],[1,"text-xs","text-gray-500","mt-1"],[1,"mt-4","flex","justify-end","gap-2"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700"],[1,"text-xs","text-gray-500","uppercase","border-b"],[1,"py-3","px-4"],[1,"py-3","px-4","text-right"],[1,"py-3","px-4","text-center"],[1,"divide-y"],[1,"hover:bg-gray-50"],[1,"py-3","px-4","font-medium","text-gray-800"],[1,"py-3","px-4","text-gray-600"],[1,"inline-block","px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded"],[1,"text-gray-400","text-sm"],[1,"py-3","px-4","text-xs"],[1,"space-y-1"],[1,"text-gray-400"],[1,"flex","items-center","justify-center","gap-2"],["title","Zn\xED\u017Ei\u0165 mno\u017Estvo",1,"px-2","py-1","bg-red-500","text-white","rounded","hover:bg-red-600","text-sm",3,"click"],["title","Zv\xFD\u0161i\u0165 mno\u017Estvo",1,"px-2","py-1","bg-green-500","text-white","rounded","hover:bg-green-600","text-sm",3,"click"],[1,"text-gray-600"],[1,"text-gray-500"],[1,"text-blue-600","italic"],[1,"inline-block","px-2","py-0.5","rounded","text-xs",3,"ngClass"],["title","Nastavi\u0165 mno\u017Estvo",1,"px-2","py-1","bg-gray-500","text-white","rounded","hover:bg-gray-600","text-sm",3,"click"],["title","Vymaza\u0165 diel",1,"px-2","py-1","bg-red-700","text-white","rounded","hover:bg-red-800","text-sm",3,"click"]],template:function(e,a){e&1&&(r(0,"div",0)(1,"h1",1),l(2),m(3,"translate"),i(),x(4,U,3,3,"button",2),i(),x(5,K,41,15,"div",3),r(6,"div",4)(7,"div",5)(8,"input",6),_("input",function(s){return a.onSearch(s)}),i()(),r(9,"div",7),x(10,ne,24,12,"table",8)(11,ae,4,3,"div",9),x(12,re,4,3,"div",9),i()()),e&2&&(d(2),p(u(3,5,"SPARE_PARTS_INVENTORY")),d(2),g(a.authService.isAdmin()?4:-1),d(),g(a.showAddForm()?5:-1),d(5),g(a.parts().length>0?10:11),d(2),g(a.filteredParts().length===0&&a.parts().length>0?12:-1))},dependencies:[M,B,H,$],encapsulation:2,changeDetection:0});var O=h;export{O as PartListComponent};
