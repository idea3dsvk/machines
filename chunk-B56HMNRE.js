import{a as H}from"./chunk-SOQTHN6Q.js";import{a as R}from"./chunk-CVODM7PI.js";import{a as O}from"./chunk-4CAQGVAX.js";import{A as o,Da as V,Ea as z,F as A,Fa as M,N as x,O as g,R as I,S as k,T as F,U as a,V as i,W as C,_ as P,aa as _,ca as u,ga as q,ha as r,ia as c,ja as h,ka as L,p as w,q as v,r as y,ta as Q,ua as p,v as S,va as m,wa as B,ya as T}from"./chunk-NTPXKIXG.js";import{a as N,b as D}from"./chunk-K5CSBBV3.js";var W=(d,n,e)=>({"bg-green-100 text-green-800":d,"bg-red-100 text-red-800":n,"bg-blue-100 text-blue-800":e}),j=(d,n)=>n.id;function U(d,n){if(d&1){let e=P();a(0,"button",15),_("click",function(){v(e);let t=u();return y(t.toggleAddForm())}),r(1),p(2,"translate"),i()}if(d&2){let e=u();o(),h(" ",e.showAddForm()?"CANCEL":m(2,1,"ADD_NEW_PART")," ")}}function Z(d,n){if(d&1&&(a(0,"option",28),r(1),i()),d&2){let e=n.$implicit;F("value",e.id),o(),L("",e.name," (",e.type,")")}}function K(d,n){if(d&1){let e=P();a(0,"div",3)(1,"h2",16),r(2),p(3,"translate"),i(),a(4,"form",17),_("submit",function(t){v(e);let s=u();return y(s.addPart(t))}),a(5,"div",18)(6,"div")(7,"label",19),r(8),p(9,"translate"),i(),C(10,"input",20),i(),a(11,"div")(12,"label",19),r(13),p(14,"translate"),i(),C(15,"input",21),i(),a(16,"div")(17,"label",19),r(18),p(19,"translate"),i(),C(20,"input",22),i(),a(21,"div")(22,"label",19),r(23),p(24,"translate"),i(),C(25,"input",23),i(),a(26,"div")(27,"label",19),r(28),p(29,"translate"),i(),C(30,"input",24),i(),a(31,"div",25)(32,"label",19),r(33,"Zariadenie (nepovinn\xE9)"),i(),a(34,"select",26)(35,"option",27),r(36,"-- V\u0161eobecn\xFD diel (nie je priraden\xFD k zariadeniu) --"),i(),I(37,Z,2,3,"option",28,j),i(),a(39,"p",29),r(40,"Vyberte zariadenie ak diel patr\xED k \u0161pecifick\xE9mu zariadeniu"),i()()(),a(41,"div",30)(42,"button",31),_("click",function(){v(e);let t=u();return y(t.toggleAddForm())}),r(43," Cancel "),i(),a(44,"button",32),r(45," Add Part "),i()()()()}if(d&2){let e=u();o(2),c(m(3,6,"ADD_NEW_PART")),o(6),c(m(9,8,"PART_NAME")),o(5),c(m(14,10,"SKU")),o(5),c(m(19,12,"QUANTITY")),o(5),c(m(24,14,"MIN_QUANTITY")),o(5),c(m(29,16,"LOCATION")),o(9),k(e.devices())}}function Y(d,n){if(d&1&&(a(0,"span",41),r(1),i()),d&2){let e=u().$implicit;o(),c(e.deviceName)}}function G(d,n){d&1&&(a(0,"span",42),r(1,"V\u0161eobecn\xFD"),i())}function J(d,n){d&1&&(a(0,"div",44),r(1,"\u26A0\uFE0F Pod minimom"),i())}function X(d,n){if(d&1&&(a(0,"div",54),r(1),i()),d&2){let e=u(2).$implicit;o(),h(' "',e.lastChange.notes,'" ')}}function ee(d,n){if(d&1&&(a(0,"div",47)(1,"div",52),r(2),p(3,"date"),i(),a(4,"div",53),r(5),i(),x(6,X,2,1,"div",54),a(7,"div",55),r(8),i()()),d&2){let e=u().$implicit;o(2),h(" ",B(3,6,e.lastChange.date,"dd.MM.yyyy HH:mm")," "),o(3),h(" ",e.lastChange.changedBy," "),o(),g(e.lastChange.notes?6:-1),o(),F("ngClass",Q(9,W,e.lastChange.changeType==="increase",e.lastChange.changeType==="decrease",e.lastChange.changeType==="set")),o(),L(" ",e.lastChange.quantityBefore," \u2192 ",e.lastChange.quantityAfter," ")}}function te(d,n){d&1&&(a(0,"span",48),r(1,"Bez zmien"),i())}function ie(d,n){if(d&1){let e=P();a(0,"button",56),_("click",function(){v(e);let t=u().$implicit,s=u(2);return y(s.setQuantity(t.id,t.quantity))}),r(1," \u270E "),i(),a(2,"button",57),_("click",function(){v(e);let t=u().$implicit,s=u(2);return y(s.deletePart(t.id,t.name))}),r(3," \u{1F5D1}\uFE0F "),i()}}function ne(d,n){if(d&1){let e=P();a(0,"tr",38)(1,"td",39),r(2),i(),a(3,"td",40),r(4),i(),a(5,"td",40),x(6,Y,2,1,"span",41)(7,G,2,0,"span",42),i(),a(8,"td",40),r(9),i(),a(10,"td",35)(11,"div",43),r(12),i(),x(13,J,2,0,"div",44),i(),a(14,"td",45),r(15),i(),a(16,"td",46),x(17,ee,9,13,"div",47)(18,te,2,0,"span",48),i(),a(19,"td",34)(20,"div",49)(21,"button",50),_("click",function(){let t=v(e).$implicit,s=u(2);return y(s.decreaseQuantity(t.id,t.quantity))}),r(22," \u2212 "),i(),x(23,ie,4,0),a(24,"button",51),_("click",function(){let t=v(e).$implicit,s=u(2);return y(s.increaseQuantity(t.id,t.quantity))}),r(25," + "),i()()()()}if(d&2){let e=n.$implicit,l=u(2);o(2),c(e.name),o(2),c(e.sku),o(2),g(e.deviceName?6:7),o(3),c(e.location),o(),q(l.getQuantityClass(e.quantity,e.minQuantity)),o(2),c(e.quantity),o(),g(e.quantity<e.minQuantity?13:-1),o(2),h(" ",e.minQuantity," "),o(2),g(e.lastChange?17:18),o(6),g(l.authService.isAdmin()?23:-1)}}function ae(d,n){if(d&1&&(a(0,"table",13)(1,"thead")(2,"tr",33)(3,"th",34),r(4),p(5,"translate"),i(),a(6,"th",34),r(7),p(8,"translate"),i(),a(9,"th",34),r(10,"Zariadenie"),i(),a(11,"th",34),r(12),p(13,"translate"),i(),a(14,"th",35),r(15),p(16,"translate"),i(),a(17,"th",35),r(18),p(19,"translate"),i(),a(20,"th",34),r(21,"Posledn\xE1 zmena"),i(),a(22,"th",36),r(23,"Actions"),i()()(),a(24,"tbody",37),I(25,ne,26,11,"tr",38,j),i()()),d&2){let e=u();o(4),c(m(5,5,"PART_NAME")),o(3),c(m(8,7,"SKU")),o(5),c(m(13,9,"LOCATION")),o(3),c(m(16,11,"QUANTITY")),o(3),c(m(19,13,"MIN_QUANTITY")),o(7),k(e.filteredParts())}}function re(d,n){d&1&&(a(0,"div",14)(1,"p",53),r(2),p(3,"translate"),i()()),d&2&&(o(2),c(m(3,1,"LOADING_PARTS")))}function oe(d,n){d&1&&(a(0,"div",14)(1,"p",53),r(2),p(3,"translate"),i()()),d&2&&(o(2),c(m(3,1,"NO_PARTS_FOUND")))}var E=class E{constructor(){this.dataService=w(R);this.authService=w(H);this.parts=T(()=>this.dataService.getPartsSignal()());this.devices=T(()=>this.dataService.getDevicesSignal()());this.searchTerm=S("");this.showAddForm=S(!1);this.partsWithHistory=S([]);this.stockFilter=S("all");this.filteredParts=T(()=>{let n=this.searchTerm().toLowerCase(),e=this.stockFilter(),t=this.partsWithHistory().length>0?this.partsWithHistory():this.parts();return e==="below-min"?t=t.filter(s=>s.quantity<s.minQuantity):e==="low"?t=t.filter(s=>s.quantity>=s.minQuantity&&s.quantity<s.minQuantity*1.5):e==="ok"&&(t=t.filter(s=>s.quantity>=s.minQuantity*1.5)),n&&(t=t.filter(s=>s.name.toLowerCase().includes(n)||s.sku.toLowerCase().includes(n)||s.location.toLowerCase().includes(n)||s.deviceName&&s.deviceName.toLowerCase().includes(n))),t});this.dataService.getParts().subscribe(()=>{this.loadPartsHistory()}),this.dataService.loadDevices().subscribe()}loadPartsHistory(){let n=this.parts(),e=[];n.forEach(l=>{this.dataService.getPartLastChange(l.id).subscribe(t=>{e.push(D(N({},l),{lastChange:t?{date:t.created_at,changedBy:t.changed_by,notes:t.notes,changeType:t.change_type,quantityBefore:t.quantity_before,quantityAfter:t.quantity_after}:void 0})),e.length===n.length&&this.partsWithHistory.set(e)})})}onSearch(n){let e=n.target;this.searchTerm.set(e.value)}onFilterChange(n){let e=n.target;this.stockFilter.set(e.value)}getQuantityClass(n,e=10){return n<e?"text-red-600 font-bold":n<e*1.5?"text-yellow-600":"text-gray-800"}toggleAddForm(){this.showAddForm.update(n=>!n)}increaseQuantity(n,e){let l=prompt("D\xF4vod zv\xFD\u0161enia mno\u017Estva (POVINN\xC9 - napr. n\xE1kup, dod\xE1vka):");if(!l||l.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zv\xFD\u0161en\xED mno\u017Estva");return}console.log("\u2795 Increasing quantity for part:",n),this.dataService.updatePartQuantity(n,e+1,l,"increase").subscribe({next:t=>{console.log("\u2705 Quantity increased:",t),setTimeout(()=>this.loadPartsHistory(),500)},error:t=>{console.error("\u274C Error increasing quantity:",t),alert("Error updating quantity: "+t.message)}})}decreaseQuantity(n,e){if(e<=0){alert("Mno\u017Estvo nem\xF4\u017Ee by\u0165 z\xE1porn\xE9");return}let l=prompt("D\xF4vod zn\xED\u017Eenia mno\u017Estva (POVINN\xC9 - napr. pou\u017Eit\xE9 pri oprave CNC Fr\xE9za):");if(!l||l.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zn\xED\u017Een\xED mno\u017Estva");return}console.log("\u2796 Decreasing quantity for part:",n),this.dataService.updatePartQuantity(n,e-1,l,"decrease").subscribe({next:t=>{console.log("\u2705 Quantity decreased:",t),setTimeout(()=>this.loadPartsHistory(),500)},error:t=>{console.error("\u274C Error decreasing quantity:",t),alert("Error updating quantity: "+t.message)}})}setQuantity(n,e){let l=prompt("Zadajte nov\xE9 mno\u017Estvo:");if(l===null)return;let t=parseInt(l);if(isNaN(t)||t<0){alert("Zadajte platn\xE9 kladn\xE9 \u010D\xEDslo");return}let s=prompt("D\xF4vod zmeny mno\u017Estva (POVINN\xC9 - napr. invent\xFAra, korekcia):");if(!s||s.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zmene mno\u017Estva");return}console.log("\u270F\uFE0F Setting quantity for part:",n,"to",t),this.dataService.updatePartQuantity(n,t,s,"set").subscribe({next:f=>{console.log("\u2705 Quantity set:",f),setTimeout(()=>this.loadPartsHistory(),500)},error:f=>{console.error("\u274C Error setting quantity:",f),alert("Error updating quantity: "+f.message)}})}addPart(n){n.preventDefault();let e=n.target,l=new FormData(e),t=l.get("deviceId"),s=t?this.devices().find(b=>b.id===t):void 0,f={name:l.get("name"),sku:l.get("sku"),quantity:parseInt(l.get("quantity")),minQuantity:parseInt(l.get("minQuantity"))||10,location:l.get("location"),deviceId:t||void 0,deviceName:s?.name||void 0};console.log("\u{1F504} Adding new part:",f),this.dataService.addPart(f).subscribe({next:b=>{console.log("\u2705 Part added successfully:",b),this.showAddForm.set(!1),e.reset(),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after adding new part"),this.loadPartsHistory()})},error:b=>{console.error("\u274C Error adding part:",b),alert("Error adding part: "+b.message)}})}deletePart(n,e){let l=`Naozaj chcete vymaza\u0165 n\xE1hradn\xFD diel "${e}"?

T\xE1to akcia sa ned\xE1 vr\xE1ti\u0165 sp\xE4\u0165 a vyma\u017Ee aj v\u0161etku hist\xF3riu zmien tohto dielu.`;confirm(l)&&(console.log("\u{1F5D1}\uFE0F Deleting part:",n),this.dataService.deletePart(n).subscribe({next:()=>{console.log("\u2705 Part deleted successfully"),alert(`N\xE1hradn\xFD diel "${e}" bol \xFAspe\u0161ne vymazan\xFD.`),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after deletion"),this.loadPartsHistory()})},error:t=>{console.error("\u274C Error deleting part:",t),alert(`Chyba pri vymaz\xE1van\xED dielu: ${t.message}`)}}))}};E.\u0275fac=function(e){return new(e||E)},E.\u0275cmp=A({type:E,selectors:[["app-part-list"]],decls:26,vars:19,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-semibold","text-gray-800"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors"],[1,"bg-white","p-6","rounded-lg","shadow-md","mb-6"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"mb-4","flex","gap-4"],["type","text","placeholder","H\u013Eada\u0165 diely (n\xE1zov, SKU, umiestnenie, zariadenie)...",1,"flex-1","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input"],[1,"px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change"],["value","all"],["value","below-min"],["value","low"],["value","ok"],[1,"overflow-x-auto"],[1,"w-full","text-left"],[1,"text-center","py-10"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"click"],[1,"text-xl","font-semibold","mb-4"],[3,"submit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","name","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","sku","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","number","name","quantity","required","","min","0",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","number","name","minQuantity","required","","min","0","value","10",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","location","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],[1,"md:col-span-2"],["name","deviceId",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["value",""],[3,"value"],[1,"text-xs","text-gray-500","mt-1"],[1,"mt-4","flex","justify-end","gap-2"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700"],[1,"text-xs","text-gray-500","uppercase","border-b"],[1,"py-3","px-4"],[1,"py-3","px-4","text-right"],[1,"py-3","px-4","text-center"],[1,"divide-y"],[1,"hover:bg-gray-50"],[1,"py-3","px-4","font-medium","text-gray-800"],[1,"py-3","px-4","text-gray-600"],[1,"inline-block","px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded"],[1,"text-gray-400","text-sm"],[1,"font-semibold"],[1,"text-xs","text-red-600"],[1,"py-3","px-4","text-right","text-gray-600"],[1,"py-3","px-4","text-xs"],[1,"space-y-1"],[1,"text-gray-400"],[1,"flex","items-center","justify-center","gap-2"],["title","Zn\xED\u017Ei\u0165 mno\u017Estvo",1,"px-2","py-1","bg-red-500","text-white","rounded","hover:bg-red-600","text-sm",3,"click"],["title","Zv\xFD\u0161i\u0165 mno\u017Estvo",1,"px-2","py-1","bg-green-500","text-white","rounded","hover:bg-green-600","text-sm",3,"click"],[1,"text-gray-600"],[1,"text-gray-500"],[1,"text-blue-600","italic"],[1,"inline-block","px-2","py-0.5","rounded","text-xs",3,"ngClass"],["title","Nastavi\u0165 mno\u017Estvo",1,"px-2","py-1","bg-gray-500","text-white","rounded","hover:bg-gray-600","text-sm",3,"click"],["title","Vymaza\u0165 diel",1,"px-2","py-1","bg-red-700","text-white","rounded","hover:bg-red-800","text-sm",3,"click"]],template:function(e,l){e&1&&(a(0,"div",0)(1,"h1",1),r(2),p(3,"translate"),i(),x(4,U,3,3,"button",2),i(),x(5,K,46,18,"div",3),a(6,"div",4)(7,"div",5)(8,"input",6),_("input",function(s){return l.onSearch(s)}),i(),a(9,"select",7),_("change",function(s){return l.onFilterChange(s)}),a(10,"option",8),r(11),p(12,"translate"),i(),a(13,"option",9),r(14),p(15,"translate"),i(),a(16,"option",10),r(17),p(18,"translate"),i(),a(19,"option",11),r(20),p(21,"translate"),i()()(),a(22,"div",12),x(23,ae,27,15,"table",13)(24,re,4,3,"div",14),x(25,oe,4,3,"div",14),i()()),e&2&&(o(2),c(m(3,9,"SPARE_PARTS_INVENTORY")),o(2),g(l.authService.isAdmin()?4:-1),o(),g(l.showAddForm()?5:-1),o(6),c(m(12,11,"FILTER_ALL_PARTS")),o(3),c(m(15,13,"FILTER_BELOW_MIN")),o(3),c(m(18,15,"FILTER_LOW_STOCK")),o(3),c(m(21,17,"FILTER_NORMAL_STOCK")),o(3),g(l.parts().length>0?23:24),o(2),g(l.filteredParts().length===0&&l.parts().length>0?25:-1))},dependencies:[M,V,z,O],encapsulation:2,changeDetection:0});var $=E;export{$ as PartListComponent};
