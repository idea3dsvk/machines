import{a as H}from"./chunk-BM4ULORI.js";import"./chunk-C6JBQQCA.js";import{a as j}from"./chunk-APG6UQ25.js";import{a as $}from"./chunk-XDKT6EX4.js";import{$b as B,Ca as d,Ib as V,Jb as m,Kb as u,Lb as z,Oa as L,Ob as T,S as w,X as v,Y as y,Za as x,_a as g,_b as Q,ac as M,bb as I,cb as N,db as k,ea as P,eb as a,fb as t,gb as C,kb as S,mb as _,ob as p,vb as q,wb as o,xb as s,yb as h,zb as D}from"./chunk-4ZOEYAJO.js";import{a as A,b as F}from"./chunk-K5CSBBV3.js";var U=(l,i,e)=>({"bg-green-100 text-green-800":l,"bg-red-100 text-red-800":i,"bg-blue-100 text-blue-800":e}),R=(l,i)=>i.id;function W(l,i){if(l&1){let e=S();a(0,"button",10),_("click",function(){v(e);let n=p();return y(n.toggleAddForm())}),o(1),m(2,"translate"),t()}if(l&2){let e=p();d(),h(" ",e.showAddForm()?"CANCEL":u(2,1,"ADD_NEW_PART")," ")}}function Z(l,i){if(l&1&&(a(0,"option",23),o(1),t()),l&2){let e=i.$implicit;k("value",e.id),d(),D("",e.name," (",e.type,")")}}function Y(l,i){if(l&1){let e=S();a(0,"div",3)(1,"h2",11),o(2),m(3,"translate"),t(),a(4,"form",12),_("submit",function(n){v(e);let c=p();return y(c.addPart(n))}),a(5,"div",13)(6,"div")(7,"label",14),o(8),m(9,"translate"),t(),C(10,"input",15),t(),a(11,"div")(12,"label",14),o(13),m(14,"translate"),t(),C(15,"input",16),t(),a(16,"div")(17,"label",14),o(18),m(19,"translate"),t(),C(20,"input",17),t(),a(21,"div")(22,"label",14),o(23),m(24,"translate"),t(),C(25,"input",18),t(),a(26,"div")(27,"label",14),o(28),m(29,"translate"),t(),C(30,"input",19),t(),a(31,"div",20)(32,"label",14),o(33,"Zariadenie (nepovinn\xE9)"),t(),a(34,"select",21)(35,"option",22),o(36,"-- V\u0161eobecn\xFD diel (nie je priraden\xFD k zariadeniu) --"),t(),I(37,Z,2,3,"option",23,R),t(),a(39,"p",24),o(40,"Vyberte zariadenie ak diel patr\xED k \u0161pecifick\xE9mu zariadeniu"),t()()(),a(41,"div",25)(42,"button",26),_("click",function(){v(e);let n=p();return y(n.toggleAddForm())}),o(43," Cancel "),t(),a(44,"button",27),o(45," Add Part "),t()()()()}if(l&2){let e=p();d(2),s(u(3,6,"ADD_NEW_PART")),d(6),s(u(9,8,"PART_NAME")),d(5),s(u(14,10,"SKU")),d(5),s(u(19,12,"QUANTITY")),d(5),s(u(24,14,"MIN_QUANTITY")),d(5),s(u(29,16,"LOCATION")),d(9),N(e.devices())}}function K(l,i){if(l&1&&(a(0,"span",36),o(1),t()),l&2){let e=p().$implicit;d(),s(e.deviceName)}}function G(l,i){l&1&&(a(0,"span",37),o(1,"V\u0161eobecn\xFD"),t())}function J(l,i){l&1&&(a(0,"div",39),o(1,"\u26A0\uFE0F Pod minimom"),t())}function X(l,i){if(l&1&&(a(0,"div",49),o(1),t()),l&2){let e=p(2).$implicit;d(),h(' "',e.lastChange.notes,'" ')}}function ee(l,i){if(l&1&&(a(0,"div",42)(1,"div",47),o(2),m(3,"date"),t(),a(4,"div",48),o(5),t(),x(6,X,2,1,"div",49),a(7,"div",50),o(8),t()()),l&2){let e=p().$implicit;d(2),h(" ",z(3,6,e.lastChange.date,"dd.MM.yyyy HH:mm")," "),d(3),h(" ",e.lastChange.changedBy," "),d(),g(e.lastChange.notes?6:-1),d(),k("ngClass",V(9,U,e.lastChange.changeType==="increase",e.lastChange.changeType==="decrease",e.lastChange.changeType==="set")),d(),D(" ",e.lastChange.quantityBefore," \u2192 ",e.lastChange.quantityAfter," ")}}function te(l,i){l&1&&(a(0,"span",43),o(1,"Bez zmien"),t())}function ie(l,i){if(l&1){let e=S();a(0,"button",51),_("click",function(){v(e);let n=p().$implicit,c=p(2);return y(c.setQuantity(n.id,n.quantity))}),o(1," \u270E "),t(),a(2,"button",52),_("click",function(){v(e);let n=p().$implicit,c=p(2);return y(c.deletePart(n.id,n.name))}),o(3," \u{1F5D1}\uFE0F "),t()}}function ne(l,i){if(l&1){let e=S();a(0,"tr",33)(1,"td",34),o(2),t(),a(3,"td",35),o(4),t(),a(5,"td",35),x(6,K,2,1,"span",36)(7,G,2,0,"span",37),t(),a(8,"td",35),o(9),t(),a(10,"td",30)(11,"div",38),o(12),t(),x(13,J,2,0,"div",39),t(),a(14,"td",40),o(15),t(),a(16,"td",41),x(17,ee,9,13,"div",42)(18,te,2,0,"span",43),t(),a(19,"td",29)(20,"div",44)(21,"button",45),_("click",function(){let n=v(e).$implicit,c=p(2);return y(c.decreaseQuantity(n.id,n.quantity))}),o(22," \u2212 "),t(),x(23,ie,4,0),a(24,"button",46),_("click",function(){let n=v(e).$implicit,c=p(2);return y(c.increaseQuantity(n.id,n.quantity))}),o(25," + "),t()()()()}if(l&2){let e=i.$implicit,r=p(2);d(2),s(e.name),d(2),s(e.sku),d(2),g(e.deviceName?6:7),d(3),s(e.location),d(),q(r.getQuantityClass(e.quantity,e.minQuantity)),d(2),s(e.quantity),d(),g(e.quantity<e.minQuantity?13:-1),d(2),h(" ",e.minQuantity," "),d(2),g(e.lastChange?17:18),d(6),g(r.authService.isAdmin()?23:-1)}}function ae(l,i){if(l&1&&(a(0,"table",8)(1,"thead")(2,"tr",28)(3,"th",29),o(4),m(5,"translate"),t(),a(6,"th",29),o(7),m(8,"translate"),t(),a(9,"th",29),o(10,"Zariadenie"),t(),a(11,"th",29),o(12),m(13,"translate"),t(),a(14,"th",30),o(15),m(16,"translate"),t(),a(17,"th",30),o(18),m(19,"translate"),t(),a(20,"th",29),o(21,"Posledn\xE1 zmena"),t(),a(22,"th",31),o(23,"Actions"),t()()(),a(24,"tbody",32),I(25,ne,26,11,"tr",33,R),t()()),l&2){let e=p();d(4),s(u(5,5,"PART_NAME")),d(3),s(u(8,7,"SKU")),d(5),s(u(13,9,"LOCATION")),d(3),s(u(16,11,"QUANTITY")),d(3),s(u(19,13,"MIN_QUANTITY")),d(7),N(e.filteredParts())}}function re(l,i){l&1&&(a(0,"div",9)(1,"p",48),o(2),m(3,"translate"),t()()),l&2&&(d(2),s(u(3,1,"LOADING_PARTS")))}function oe(l,i){l&1&&(a(0,"div",9)(1,"p",48),o(2),m(3,"translate"),t()()),l&2&&(d(2),s(u(3,1,"NO_PARTS_FOUND")))}var E=class E{constructor(){this.dataService=w(j);this.authService=w(H);this.parts=T(()=>this.dataService.getPartsSignal()());this.devices=T(()=>this.dataService.getDevicesSignal()());this.searchTerm=P("");this.showAddForm=P(!1);this.partsWithHistory=P([]);this.filteredParts=T(()=>{let i=this.searchTerm().toLowerCase(),e=this.partsWithHistory().length>0?this.partsWithHistory():this.parts();return i?e.filter(r=>r.name.toLowerCase().includes(i)||r.sku.toLowerCase().includes(i)||r.location.toLowerCase().includes(i)||r.deviceName&&r.deviceName.toLowerCase().includes(i)):e});this.dataService.getParts().subscribe(()=>{this.loadPartsHistory()}),this.dataService.loadDevices().subscribe()}loadPartsHistory(){let i=this.parts(),e=[];i.forEach(r=>{this.dataService.getPartLastChange(r.id).subscribe(n=>{e.push(F(A({},r),{lastChange:n?{date:n.created_at,changedBy:n.changed_by,notes:n.notes,changeType:n.change_type,quantityBefore:n.quantity_before,quantityAfter:n.quantity_after}:void 0})),e.length===i.length&&this.partsWithHistory.set(e)})})}onSearch(i){let e=i.target;this.searchTerm.set(e.value)}getQuantityClass(i,e=10){return i<e?"text-red-600 font-bold":i<e*1.5?"text-yellow-600":"text-gray-800"}toggleAddForm(){this.showAddForm.update(i=>!i)}increaseQuantity(i,e){let r=prompt("D\xF4vod zv\xFD\u0161enia mno\u017Estva (POVINN\xC9 - napr. n\xE1kup, dod\xE1vka):");if(!r||r.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zv\xFD\u0161en\xED mno\u017Estva");return}console.log("\u2795 Increasing quantity for part:",i),this.dataService.updatePartQuantity(i,e+1,r,"increase").subscribe({next:n=>{console.log("\u2705 Quantity increased:",n),setTimeout(()=>this.loadPartsHistory(),500)},error:n=>{console.error("\u274C Error increasing quantity:",n),alert("Error updating quantity: "+n.message)}})}decreaseQuantity(i,e){if(e<=0){alert("Mno\u017Estvo nem\xF4\u017Ee by\u0165 z\xE1porn\xE9");return}let r=prompt("D\xF4vod zn\xED\u017Eenia mno\u017Estva (POVINN\xC9 - napr. pou\u017Eit\xE9 pri oprave CNC Fr\xE9za):");if(!r||r.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zn\xED\u017Een\xED mno\u017Estva");return}console.log("\u2796 Decreasing quantity for part:",i),this.dataService.updatePartQuantity(i,e-1,r,"decrease").subscribe({next:n=>{console.log("\u2705 Quantity decreased:",n),setTimeout(()=>this.loadPartsHistory(),500)},error:n=>{console.error("\u274C Error decreasing quantity:",n),alert("Error updating quantity: "+n.message)}})}setQuantity(i,e){let r=prompt("Zadajte nov\xE9 mno\u017Estvo:");if(r===null)return;let n=parseInt(r);if(isNaN(n)||n<0){alert("Zadajte platn\xE9 kladn\xE9 \u010D\xEDslo");return}let c=prompt("D\xF4vod zmeny mno\u017Estva (POVINN\xC9 - napr. invent\xFAra, korekcia):");if(!c||c.trim()===""){alert("Pozn\xE1mka je povinn\xE1 pri zmene mno\u017Estva");return}console.log("\u270F\uFE0F Setting quantity for part:",i,"to",n),this.dataService.updatePartQuantity(i,n,c,"set").subscribe({next:b=>{console.log("\u2705 Quantity set:",b),setTimeout(()=>this.loadPartsHistory(),500)},error:b=>{console.error("\u274C Error setting quantity:",b),alert("Error updating quantity: "+b.message)}})}addPart(i){i.preventDefault();let e=i.target,r=new FormData(e),n=r.get("deviceId"),c=n?this.devices().find(f=>f.id===n):void 0,b={name:r.get("name"),sku:r.get("sku"),quantity:parseInt(r.get("quantity")),minQuantity:parseInt(r.get("minQuantity"))||10,location:r.get("location"),deviceId:n||void 0,deviceName:c?.name||void 0};console.log("\u{1F504} Adding new part:",b),this.dataService.addPart(b).subscribe({next:f=>{console.log("\u2705 Part added successfully:",f),this.showAddForm.set(!1),e.reset(),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after adding new part"),this.loadPartsHistory()})},error:f=>{console.error("\u274C Error adding part:",f),alert("Error adding part: "+f.message)}})}deletePart(i,e){let r=`Naozaj chcete vymaza\u0165 n\xE1hradn\xFD diel "${e}"?

T\xE1to akcia sa ned\xE1 vr\xE1ti\u0165 sp\xE4\u0165 a vyma\u017Ee aj v\u0161etku hist\xF3riu zmien tohto dielu.`;confirm(r)&&(console.log("\u{1F5D1}\uFE0F Deleting part:",i),this.dataService.deletePart(i).subscribe({next:()=>{console.log("\u2705 Part deleted successfully"),alert(`N\xE1hradn\xFD diel "${e}" bol \xFAspe\u0161ne vymazan\xFD.`),this.dataService.getParts().subscribe(()=>{console.log("\u{1F504} Parts list refreshed after deletion"),this.loadPartsHistory()})},error:n=>{console.error("\u274C Error deleting part:",n),alert(`Chyba pri vymaz\xE1van\xED dielu: ${n.message}`)}}))}};E.\u0275fac=function(e){return new(e||E)},E.\u0275cmp=L({type:E,selectors:[["app-part-list"]],decls:13,vars:7,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-semibold","text-gray-800"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors"],[1,"bg-white","p-6","rounded-lg","shadow-md","mb-6"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"mb-4"],["type","text","placeholder","H\u013Eada\u0165 diely (n\xE1zov, SKU, umiestnenie, zariadenie)...",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input"],[1,"overflow-x-auto"],[1,"w-full","text-left"],[1,"text-center","py-10"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","transition-colors",3,"click"],[1,"text-xl","font-semibold","mb-4"],[3,"submit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","name","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","sku","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","number","name","quantity","required","","min","0",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","number","name","minQuantity","required","","min","0","value","10",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["type","text","name","location","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],[1,"md:col-span-2"],["name","deviceId",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500"],["value",""],[3,"value"],[1,"text-xs","text-gray-500","mt-1"],[1,"mt-4","flex","justify-end","gap-2"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700"],[1,"text-xs","text-gray-500","uppercase","border-b"],[1,"py-3","px-4"],[1,"py-3","px-4","text-right"],[1,"py-3","px-4","text-center"],[1,"divide-y"],[1,"hover:bg-gray-50"],[1,"py-3","px-4","font-medium","text-gray-800"],[1,"py-3","px-4","text-gray-600"],[1,"inline-block","px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded"],[1,"text-gray-400","text-sm"],[1,"font-semibold"],[1,"text-xs","text-red-600"],[1,"py-3","px-4","text-right","text-gray-600"],[1,"py-3","px-4","text-xs"],[1,"space-y-1"],[1,"text-gray-400"],[1,"flex","items-center","justify-center","gap-2"],["title","Zn\xED\u017Ei\u0165 mno\u017Estvo",1,"px-2","py-1","bg-red-500","text-white","rounded","hover:bg-red-600","text-sm",3,"click"],["title","Zv\xFD\u0161i\u0165 mno\u017Estvo",1,"px-2","py-1","bg-green-500","text-white","rounded","hover:bg-green-600","text-sm",3,"click"],[1,"text-gray-600"],[1,"text-gray-500"],[1,"text-blue-600","italic"],[1,"inline-block","px-2","py-0.5","rounded","text-xs",3,"ngClass"],["title","Nastavi\u0165 mno\u017Estvo",1,"px-2","py-1","bg-gray-500","text-white","rounded","hover:bg-gray-600","text-sm",3,"click"],["title","Vymaza\u0165 diel",1,"px-2","py-1","bg-red-700","text-white","rounded","hover:bg-red-800","text-sm",3,"click"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"h1",1),o(2),m(3,"translate"),t(),x(4,W,3,3,"button",2),t(),x(5,Y,46,18,"div",3),a(6,"div",4)(7,"div",5)(8,"input",6),_("input",function(c){return r.onSearch(c)}),t()(),a(9,"div",7),x(10,ae,27,15,"table",8)(11,re,4,3,"div",9),x(12,oe,4,3,"div",9),t()()),e&2&&(d(2),s(u(3,5,"SPARE_PARTS_INVENTORY")),d(2),g(r.authService.isAdmin()?4:-1),d(),g(r.showAddForm()?5:-1),d(5),g(r.parts().length>0?10:11),d(2),g(r.filteredParts().length===0&&r.parts().length>0?12:-1))},dependencies:[M,Q,B,$],encapsulation:2,changeDetection:0});var O=E;export{O as PartListComponent};
